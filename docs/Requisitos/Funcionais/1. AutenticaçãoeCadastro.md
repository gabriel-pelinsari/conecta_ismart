
### MÓDULO 1: AUTENTICAÇÃO E CADASTRO

#### RF001 - Upload de CSV com emails dos alunos pelo administrador

##### User Story
Como administrador do ISMART
Quero fazer upload de um arquivo CSV contendo emails dos alunos
Para convidar múltiplos alunos de uma só vez para se cadastrarem na plataforma

##### Descrição
Sistema que permite ao administrador fazer upload de um arquivo CSV contendo emails de alunos ISMART. O sistema valida o formato do arquivo, processa os emails e os armazena no banco de dados como convites pendentes.

##### Regras de Negócio
- RN001: O arquivo CSV deve ter no máximo 10.000 linhas
- RN002: O arquivo deve conter obrigatoriamente uma coluna "email"
- RN003: Emails duplicados no arquivo devem ser ignorados (considerar apenas a primeira ocorrência)
- RN004: Emails já cadastrados na plataforma devem ser sinalizados mas não bloqueiam o upload
- RN005: Formato de email deve seguir padrão RFC 5322
- RN006: Apenas administradores autenticados podem fazer upload
- RN007: O arquivo deve estar em formato .csv com encoding UTF-8

##### Critérios de Aceitação
- [ ] Dado que sou um administrador autenticado
      Quando faço upload de um CSV válido com 100 emails
      Então o sistema processa todos os 100 emails e exibe mensagem de sucesso
      
- [ ] Dado que faço upload de um CSV com emails duplicados
      Quando o sistema processa o arquivo
      Então apenas emails únicos são armazenados e total correto é exibido
      
- [ ] Dado que faço upload de um CSV com emails já cadastrados
      Quando o sistema processa o arquivo
      Então uma lista de emails já existentes é exibida como aviso
      
- [ ] Dado que faço upload de um arquivo com mais de 10.000 linhas
      Quando tento submeter o arquivo
      Então o sistema exibe erro e não processa o arquivo
      
- [ ] Dado que faço upload de um arquivo que não é CSV
      Quando tento submeter o arquivo
      Então o sistema exibe erro informando formato inválido

##### Prioridade
Alta - Funcionalidade crítica para onboarding de alunos

##### Complexidade
Média - Requer validações robustas e processamento de arquivo

##### Dependências
Nenhuma (é o primeiro passo do fluxo)

##### Notas/Observações
- Usar biblioteca como `pandas` (Python) ou `papaparse` (JS) para parsing
- Implementar barra de progresso para uploads grandes (>1000 linhas)
- Logs detalhados: quantidade processada, ignorada, com erro
- Considerar processamento assíncrono se arquivo for muito grande
- Permitir download de template CSV para o admin

#### RF002 - Envio automático de email com código único de cadastro

##### User Story
Como sistema ISMART Conecta
Quero enviar automaticamente emails com códigos únicos de cadastro
Para que apenas alunos autorizados possam se registrar na plataforma

##### Descrição
Após o upload do CSV, o sistema gera códigos únicos de cadastro e envia emails automaticamente para cada endereço processado. Os emails contêm instruções de cadastro e um link com o código pré-preenchido.

##### Regras de Negócio
- RN001: Cada email recebe um código único alfanumérico de 12 caracteres
- RN002: Código tem validade de 30 dias a partir da geração
- RN003: Código pode ser usado apenas uma vez (single-use)
- RN004: Email deve ser enviado em até 5 minutos após upload do CSV
- RN005: Sistema deve registrar tentativas de envio (sucesso/falha)
- RN006: Máximo de 3 tentativas de reenvio automático em caso de falha
- RN007: Taxa de envio: máximo 100 emails por minuto (evitar bloqueio SMTP)
- RN008: Email deve vir de domínio confiável (ex: noreply@ismartconecta.org.br)

##### Critérios de Aceitação
- [ ] Dado que o admin fez upload de CSV com 50 emails
      Quando o processamento é concluído
      Então 50 emails são enfileirados e enviados em até 5 minutos
      
- [ ] Dado que um email de cadastro é enviado
      Quando o aluno recebe o email
      Então ele contém código único, link direto para cadastro e instruções claras
      
- [ ] Dado que um envio de email falha
      Quando o sistema detecta a falha
      Então registra o erro e tenta reenviar até 3 vezes
      
- [ ] Dado que um código foi gerado há 31 dias
      Quando aluno tenta usar o código
      Então o sistema informa que o código expirou e orienta contatar admin
      
- [ ] Dado que o sistema está enviando emails em massa
      Quando ultrapassa 100 emails por minuto
      Então os demais ficam em fila para envio gradual

##### Prioridade
Alta - Crítico para segurança e controle de acesso

##### Complexidade
Alta - Integração com serviço SMTP, controle de filas, retry logic

##### Dependências
RF001 (Upload de CSV)

##### Notas/Observações
- Usar serviço confiável: SendGrid, AWS SES ou Mailgun
- Implementar fila com Redis ou Celery (Python) para processamento assíncrono
- Template de email deve ser customizável pelo admin
- Dashboard admin deve mostrar: enviados, falhas, pendentes
- Implementar webhook para tracking de abertura (opcional)
- Considerar allowlist de IPs para evitar bloqueio por spam filters

#### RF003 - Tela de registro com validação de código de cadastro

##### User Story
Como aluno ISMART convidado
Quero me cadastrar na plataforma usando o código recebido por email
Para criar minha conta e acessar a comunidade

##### Descrição
Página de registro onde o aluno insere o código recebido por email e preenche seus dados básicos (nome, email, senha, universidade, curso). O sistema valida o código antes de permitir o cadastro completo.

##### Regras de Negócio
- RN001: Código deve ser validado antes de exibir formulário completo
- RN002: Campos obrigatórios: código, nome completo, email, senha, confirmar senha, universidade, curso, semestre
- RN003: Senha deve ter no mínimo 8 caracteres, 1 maiúscula, 1 número
- RN004: Email do formulário deve corresponder ao email do código
- RN005: Código inválido/expirado impede prosseguimento
- RN006: Universidade e curso devem ser selecionados de lista pré-definida
- RN007: Após cadastro bem-sucedido, código é marcado como "usado" e não pode ser reutilizado

##### Critérios de Aceitação
- [ ] Dado que acesso a página de registro
      Quando insiro um código válido
      Então o formulário completo de cadastro é exibido
      
- [ ] Dado que insiro um código inválido ou expirado
      Quando clico em validar
      Então vejo mensagem de erro clara explicando o problema
      
- [ ] Dado que preencho todos os campos obrigatórios corretamente
      Quando submeto o formulário
      Então minha conta é criada e sou redirecionado para completar perfil
      
- [ ] Dado que coloco email diferente do código
      Quando tento submeter
      Então vejo erro informando que email deve corresponder ao convite
      
- [ ] Dado que insiro senha fraca (ex: "123456")
      Quando tento submeter
      Então vejo validação em tempo real informando requisitos de senha
      
- [ ] Dado que já usei meu código em cadastro anterior
      Quando tento usar novamente
      Então sistema informa que código já foi utilizado

##### Prioridade
Alta - Porta de entrada principal dos usuários

##### Complexidade
Média - Validações múltiplas e UX crítico

##### Dependências
RF002 (Envio de email com código)

##### Notas/Observações
- Link no email deve pré-preencher campo de código
- Validação de código deve ser instantânea (API call)
- Feedback visual claro: código válido ✅ / inválido ❌
- Lista de universidades deve vir de API (não hardcoded)
- Implementar autocomplete para universidades
- Força da senha deve ser mostrada visualmente (barra de progresso)
- Aceitar colagem de código (remover espaços automaticamente)

#### RF004 - Sistema de login com email e senha

##### User Story
Como aluno cadastrado
Quero fazer login com meu email e senha
Para acessar a plataforma e suas funcionalidades

##### Descrição
Página de login onde usuários autenticam com email e senha. Após validação bem-sucedida, o sistema gera token JWT e redireciona para página inicial da plataforma.

##### Regras de Negócio
- RN001: Login deve ser case-insensitive para email
- RN002: Senha é case-sensitive
- RN003: Máximo de 5 tentativas de login incorretas em 15 minutos
- RN004: Após 5 tentativas, conta fica bloqueada por 30 minutos
- RN005: Token JWT tem validade de 24 horas
- RN006: Sistema deve gerar refresh token com validade de 7 dias
- RN007: Contas desativadas pelo admin não podem fazer login
- RN008: Primeiro login redireciona para completar perfil obrigatório

##### Critérios de Aceitação
- [ ] Dado que tenho conta ativa e insiro credenciais corretas
      Quando clico em "Entrar"
      Então sou autenticado e redirecionado para página inicial
      
- [ ] Dado que insiro email ou senha incorretos
      Quando tento fazer login
      Então vejo mensagem genérica "Email ou senha incorretos" (não especificar qual está errado)
      
- [ ] Dado que erro senha 5 vezes em 15 minutos
      Quando tento a 6ª vez
      Então vejo mensagem informando bloqueio temporário de 30 minutos
      
- [ ] Dado que minha conta foi desativada pelo admin
      Quando tento fazer login
      Então vejo mensagem "Conta desativada. Contate o administrador."
      
- [ ] Dado que faço login com sucesso
      Quando recebo o token
      Então ele é armazenado de forma segura (httpOnly cookie ou localStorage)
      
- [ ] Dado que faço primeiro login
      Quando autenticação é bem-sucedida
      Então sou redirecionado para página "Completar Perfil"

##### Prioridade
Alta - Funcionalidade essencial para acesso

##### Complexidade
Média - Requer segurança robusta e gerenciamento de sessão

##### Dependências
RF003 (Cadastro), RF008 (Criptografia de senha)

##### Notas/Observações
- Implementar "Lembrar-me" (checkbox que estende validade do refresh token)
- Botão "Mostrar/Ocultar senha" (ícone de olho)
- Link para "Esqueci minha senha" visível
- Logs de tentativas de login para auditoria
- Considerar autenticação de dois fatores (2FA) na Fase 2
- Rate limiting no endpoint de login (prevenir brute force)

#### RF005 - Recuperação de senha via email

##### User Story
Como aluno que esqueceu a senha
Quero receber um link de recuperação por email
Para redefinir minha senha e voltar a acessar a plataforma

##### Descrição
Funcionalidade que permite ao usuário solicitar redefinição de senha através de link seguro enviado por email. O link contém token único com validade limitada.

##### Regras de Negócio
- RN001: Token de recuperação tem validade de 1 hora
- RN002: Token pode ser usado apenas uma vez
- RN003: Máximo 3 solicitações de recuperação por email em 24 horas
- RN004: Email de recuperação deve ser enviado em até 2 minutos
- RN005: Nova senha deve seguir mesmas regras de complexidade do cadastro
- RN006: Ao redefinir senha, todas as sessões ativas do usuário são invalidadas
- RN007: Não informar se email existe ou não na base (segurança)
- RN008: Link expirado redireciona para solicitar novo link

##### Critérios de Aceitação
- [ ] Dado que acesso página "Esqueci minha senha"
      Quando insiro meu email cadastrado
      Então recebo email com link de recuperação em até 2 minutos
      
- [ ] Dado que insiro email não cadastrado
      Quando solicito recuperação
      Então vejo mensagem genérica "Se o email existir, você receberá instruções"
      
- [ ] Dado que clico no link de recuperação válido
      Quando acesso a página
      Então vejo formulário para criar nova senha
      
- [ ] Dado que o token expirou (>1 hora)
      Quando tento usar o link
      Então vejo mensagem informando expiração e botão para solicitar novo link
      
- [ ] Dado que defino nova senha com sucesso
      Quando confirmo a alteração
      Então todas as minhas sessões ativas são encerradas e sou redirecionado para login
      
- [ ] Dado que tentei recuperar senha 3 vezes em 24h
      Quando tento pela 4ª vez
      Então vejo mensagem informando limite atingido e orientando contatar suporte

##### Prioridade
Alta - Funcionalidade crítica para retenção de usuários

##### Complexidade
Média - Requer geração de tokens seguros e controle de estado

##### Dependências
RF004 (Login), RF008 (Criptografia)

##### Notas/Observações
- Token deve ser UUID v4 ou hash criptográfico (SHA-256)
- Link deve ser: `https://plataforma.com/recuperar-senha?token=XXXX`
- Email deve ter design responsivo e instruções claras
- Armazenar timestamp da solicitação para auditoria
- Implementar logging de todas as redefinições
- Considerar código de 6 dígitos como alternativa (enviado por SMS na Fase 2)

#### RF006 - Validação de dados obrigatórios no cadastro

##### User Story
Como sistema ISMART Conecta
Quero validar todos os dados obrigatórios durante o cadastro
Para garantir integridade dos dados e qualidade dos perfis

##### Descrição
Conjunto de validações aplicadas em tempo real e no backend durante o processo de cadastro, garantindo que todos os campos obrigatórios sejam preenchidos corretamente antes de criar a conta.

##### Regras de Negócio
- RN001: Campos obrigatórios: código, nome completo, email, senha, confirmar senha, universidade, curso, semestre
- RN002: Nome deve ter no mínimo 3 caracteres e no máximo 100
- RN003: Email deve ser válido segundo RFC 5322
- RN004: Senha: mínimo 8 caracteres, pelo menos 1 maiúscula, 1 minúscula, 1 número
- RN005: Confirmar senha deve ser idêntico ao campo senha
- RN006: Semestre deve ser número entre 1 e 12
- RN007: Universidade deve existir na lista pré-definida
- RN008: Curso deve existir na lista pré-definida
- RN009: Validações devem ocorrer em tempo real (frontend) e no envio (backend)

##### Critérios de Aceitação
- [ ] Dado que deixo campo obrigatório em branco
      Quando tento submeter o formulário
      Então vejo mensagem específica indicando campo obrigatório
      
- [ ] Dado que insiro email inválido (ex: "teste@")
      Quando saio do campo
      Então vejo validação instantânea informando formato inválido
      
- [ ] Dado que insiro senha que não atende requisitos
      Quando digito no campo senha
      Então vejo indicador visual de força e checklist de requisitos
      
- [ ] Dado que confirmo senha diferente da senha original
      Quando saio do campo "Confirmar senha"
      Então vejo mensagem "As senhas não coincidem"
      
- [ ] Dado que preencho todos os campos corretamente
      Quando submeto o formulário
      Então validações de backend confirmam dados e conta é criada
      
- [ ] Dado que tento burlar validações do frontend (via DevTools)
      Quando envio dados inválidos direto para API
      Então backend rejeita com erro 400 e lista de campos inválidos

##### Prioridade
Alta - Essencial para qualidade de dados

##### Complexidade
Baixa - Validações padrão de formulários

##### Dependências
RF003 (Tela de registro)

##### Notas/Observações
- Usar biblioteca de validação: Yup (React) ou Pydantic (FastAPI)
- Feedback visual: campo com erro = borda vermelha + mensagem abaixo
- Desabilitar botão "Cadastrar" enquanto formulário inválido
- Mensagens de erro devem ser claras e orientativas
- Validação de email pode incluir verificação de domínio (mx record check)
- Lista de universidades/cursos deve ser carregada via API

#### RF007 - Prevenção de cadastros duplicados

##### User Story
Como sistema ISMART Conecta
Quero impedir que o mesmo email seja cadastrado mais de uma vez
Para evitar contas duplicadas e garantir unicidade de usuários

##### Descrição
Mecanismo de verificação que impede a criação de múltiplas contas com o mesmo email, tanto durante o cadastro quanto na tentativa de uso de códigos já utilizados.

##### Regras de Negócio
- RN001: Email é chave única na base de dados (constraint no DB)
- RN002: Verificação de email existente deve ocorrer antes de processar cadastro
- RN003: Comparação de email deve ser case-insensitive (converter para lowercase)
- RN004: Código de cadastro só pode ser usado uma vez
- RN005: Tentativa de cadastro duplicado deve retornar erro claro
- RN006: Email com espaços antes/depois deve ser normalizado (trim)
- RN007: Admin pode visualizar tentativas de cadastros duplicados no painel

##### Critérios de Aceitação
- [ ] Dado que tento me cadastrar com email já existente
      Quando submeto o formulário
      Então vejo mensagem "Este email já está cadastrado. Faça login."
      
- [ ] Dado que tento usar código já utilizado em outro cadastro
      Quando valido o código
      Então vejo mensagem "Código já foi utilizado"
      
- [ ] Dado que insiro email com maiúsculas (Ex: Usuario@Email.com)
      Quando o sistema verifica duplicidade
      Então detecta corretamente se usuario@email.com já existe
      
- [ ] Dado que insiro email com espaços (ex: " user@email.com ")
      Quando sistema processa
      Então normaliza para "user@email.com" antes de verificar
      
- [ ] Dado que existe tentativa de duplicação via API direta
      Quando backend detecta email duplicado
      Então retorna erro 409 (Conflict) com mensagem clara
      
- [ ] Dado que sou admin
      Quando acesso painel de monitoramento
      Então vejo log de tentativas de cadastros duplicados

##### Prioridade
Alta - Crítico para integridade de dados

##### Complexidade
Baixa - Validação simples com constraint de DB

##### Dependências
RF003 (Cadastro), RF006 (Validações)

##### Notas/Observações
- Constraint UNIQUE no campo email da tabela users
- Index no campo email para performance de busca
- Normalização: lowercase + trim antes de salvar
- Log de tentativas duplicadas para análise de comportamento
- Mensagem de erro não deve expor se email existe (segurança)
- Considerar soft delete (não remover usuários permanentemente)

#### RF008 - Criptografia de senha no banco de dados

##### User Story
Como sistema ISMART Conecta
Quero armazenar senhas de forma criptografada
Para proteger dados sensíveis dos usuários conforme LGPD

##### Descrição
Implementação de algoritmo de hashing seguro para senhas antes de armazená-las no banco de dados, garantindo que senhas nunca sejam armazenadas em texto plano.

##### Regras de Negócio
- RN001: Senhas devem ser hasheadas usando bcrypt com cost factor ≥12
- RN002: Nunca armazenar senha em texto plano
- RN003: Hash deve incluir salt único por senha (bcrypt faz automaticamente)
- RN004: Logs e mensagens de erro não devem expor senhas
- RN005: Validação de senha no login usa comparação segura de hash
- RN006: Rotação de algoritmo deve ser planejada (migração futura para Argon2)
- RN007: Senhas temporárias (se houver) seguem mesmas regras

##### Critérios de Aceitação
- [ ] Dado que me cadastro com senha "SenhaSegura123"
      Quando sistema salva no banco
      Então armazena hash bcrypt (ex: $2b$12$...) e não texto plano
      
- [ ] Dado que verifico banco de dados diretamente
      Quando consulto tabela de usuários
      Então vejo apenas hashes, nunca senhas originais
      
- [ ] Dado que faço login com senha correta
      Quando sistema valida
      Então compara hash armazenado com hash da senha fornecida
      
- [ ] Dado que ocorre erro durante login
      Quando sistema gera log
      Então senha não aparece na mensagem de erro ou log
      
- [ ] Dado que resetei minha senha
      Quando nova senha é salva
      Então novo hash é gerado (diferente do anterior mesmo se senha for igual)
      
- [ ] Dado que sistema é auditado
      Quando verificam segurança
      Então algoritmo bcrypt com cost ≥12 é confirmado

##### Prioridade
Alta - Requisito de segurança e conformidade legal

##### Complexidade
Baixa - Biblioteca padrão disponível

##### Dependências
RF003 (Cadastro), RF004 (Login), RF005 (Recuperação)

##### Notas/Observações
- Usar biblioteca: `bcrypt` (Python/Node)
- Cost factor 12 = ~250ms por hash (balanceado)
- Nunca usar MD5, SHA-1 ou hash sem salt
- Implementar rate limiting adicional no endpoint de login
- Documentar algoritmo usado para auditoria futura
- Planejar migração para Argon2 na Fase 2 (vencedor PHC 2015)
- Variável de ambiente para configurar cost factor

#### RF009 - Logout de usuário

##### User Story
Como aluno autenticado
Quero fazer logout da plataforma
Para encerrar minha sessão de forma segura

##### Descrição
Funcionalidade que permite ao usuário encerrar sua sessão ativa, invalidando tokens JWT e limpando dados de autenticação do navegador.

##### Regras de Negócio
- RN001: Logout deve invalidar token JWT atual
- RN002: Refresh token associado deve ser invalidado
- RN003: Dados sensíveis devem ser limpos do localStorage/sessionStorage
- RN004: Cookies de sessão devem ser removidos
- RN005: Redirecionamento automático para página de login
- RN006: Histórico de navegação sensível deve ser limpo (opcional)
- RN007: Logout deve funcionar mesmo com token expirado

##### Critérios de Aceitação
- [ ] Dado que estou autenticado e clico em "Sair"
      Quando confirmo o logout
      Então meu token é invalidado e sou redirecionado para login
      
- [ ] Dado que fiz logout
      Quando tento acessar página protegida diretamente (via URL)
      Então sou redirecionado para login automaticamente
      
- [ ] Dado que fiz logout em um dispositivo
      Quando tento usar token antigo em outro dispositivo
      Então sistema rejeita com erro 401 (Unauthorized)
      
- [ ] Dado que meu token já expirou
      Quando clico em logout
      Então processo funciona normalmente e sou redirecionado
      
- [ ] Dado que fiz logout
      Quando inspeciono localStorage/cookies
      Então não encontro tokens ou dados sensíveis armazenados
      
- [ ] Dado que clico em "Voltar" do navegador após logout
      Quando tento acessar página anterior
      Então sou redirecionado para login (não carrega conteúdo cacheado)

##### Prioridade
Alta - Funcionalidade essencial de segurança

##### Complexidade
Baixa - Limpeza de estado e redirecionamento

##### Dependências
RF004 (Login)

##### Notas/Observações
- Botão "Sair" deve estar visível no menu/navbar
- Implementar modal de confirmação (opcional): "Deseja realmente sair?"
- Backend deve manter blacklist de tokens invalidados (até expiração)
- Considerar usar Redis para blacklist com TTL automático
- Header de cache deve prevenir carregamento de páginas protegidas após logout
- Implementar "Sair de todos os dispositivos" (invalidar todos os refresh tokens)
- Logs de logout para auditoria (timestamp, IP)