### M√ìDULO 5: SISTEMA DE AMIZADES

#### RF056 - Bot√£o "Adicionar amigo" em perfis

##### User Story
Como **aluno cadastrado**
Quero **visualizar bot√£o "Adicionar amigo" em perfis de outros alunos**
Para **enviar solicita√ß√£o de amizade e expandir minha rede**

##### Descri√ß√£o
Bot√£o chamada-√†-a√ß√£o presente em perfis de outros usu√°rios permitindo iniciar processo de conex√£o com status din√¢mico (Adicionar amigo, Solicita√ß√£o enviada, Amigos, etc).

##### Regras de Neg√≥cio
- RN001: Bot√£o vis√≠vel apenas em perfis de outros usu√°rios (n√£o no meu pr√≥prio)
- RN002: Estados poss√≠veis: "Adicionar amigo", "Solicita√ß√£o enviada", "Amigos", "Solicita√ß√£o recebida"
- RN003: Cor/estilo muda conforme estado (verde=a√ß√£o, cinza=pendente, azul=conectado)
- RN004: Clique no bot√£o abre modal de confirma√ß√£o ou inicia a√ß√£o direta
- RN005: Desabilitar ap√≥s clique (evitar cliques duplos)
- RN006: Tooltip com explica√ß√£o do estado atual
- RN007: Posi√ß√£o padr√£o: abaixo da foto/nome no perfil

##### Crit√©rios de Aceita√ß√£o
- [ ] Dado que visualizo perfil de aluno que N√ÉO √© meu amigo
      Quando vejo bot√£o
      Ent√£o mostra "Adicionar amigo" em cor verde e est√° ativado
      
- [ ] Dado que clico em "Adicionar amigo"
      Quando confirmo a√ß√£o
      Ent√£o bot√£o muda para "Solicita√ß√£o enviada" em cinza (desabilitado)
      
- [ ] Dado que recebi solicita√ß√£o de amizade
      Quando visualizo perfil de quem mandou
      Ent√£o bot√£o mostra "Solicita√ß√£o recebida" com op√ß√µes "Aceitar/Recusar"
      
- [ ] Dado que j√° somos amigos
      Quando visualizo perfil dele
      Ent√£o bot√£o mostra "Amigos" e oferece op√ß√£o "Remover amizade"
      
- [ ] Dado que passo mouse sobre bot√£o
      Quando hover ativa
      Ent√£o vejo tooltip explicando estado atual

##### Prioridade
**Alta** - Interface cr√≠tica de conex√£o

##### Complexidade
**Baixa** - Bot√£o com m√∫ltiplos estados

##### Depend√™ncias
RF011 (Visualizar perfil de outros), RF056-RF067 (Sistema de amizades)

##### Notas/Observa√ß√µes
- Estados armazenados em tabela `friendships` com status enum
- √çcone visual: + (adicionar), ‚úì (conectado), ‚è≥ (pendente)
- Loading spinner durante requisi√ß√£o
- Debounce de cliques (300ms)
- Disabled state visual claro
- Responsive: bot√£o adapta em mobile
- Considerar anima√ß√£o de confirma√ß√£o (celebra√ß√£o emoji)



#### RF057 - Envio de solicita√ß√£o de amizade

##### User Story
Como **aluno cadastrado**
Quero **enviar solicita√ß√£o de amizade para outro aluno**
Para **iniciar processo de conex√£o e expandir minha rede**

##### Descri√ß√£o
Funcionalidade que registra solicita√ß√£o de amizade entre dois usu√°rios com valida√ß√µes para evitar duplica√ß√£o e spam.

##### Regras de Neg√≥cio
- RN001: Solicita√ß√£o cria registro em tabela `friendships` com status "pending"
- RN002: Solicita√ß√£o √© unidirecional (n√£o bidirecional)
- RN003: N√£o √© poss√≠vel enviar solicita√ß√£o para si pr√≥prio
- RN004: Valida√ß√£o: m√°ximo 1 solicita√ß√£o pendente por par de usu√°rios
- RN005: Limite de taxa: m√°ximo 10 solicita√ß√µes por hora por usu√°rio (anti-spam)
- RN006: Timestamp de cria√ß√£o registrado para auditoria
- RN007: Notifica√ß√£o enviada ao receptor imediatamente

##### Crit√©rios de Aceita√ß√£o
- [ ] Dado que clico "Adicionar amigo" no perfil de Jo√£o
      Quando confirmo
      Ent√£o solicita√ß√£o √© registrada com status "pending" e Jo√£o recebe notifica√ß√£o
      
- [ ] Dado que tento enviar solicita√ß√£o para mim mesmo
      Quando tentou
      Ent√£o vejo erro "N√£o √© poss√≠vel enviar solicita√ß√£o para si mesmo"
      
- [ ] Dado que j√° enviei solicita√ß√£o para Pedro
      Quando tento enviar outra
      Ent√£o vejo erro "Voc√™ j√° enviou solicita√ß√£o para este aluno"
      
- [ ] Dado que enviei 10 solicita√ß√µes em 30 minutos
      Quando tento enviar a 11¬™ em 1 hora
      Ent√£o vejo erro "Limite de solicita√ß√µes atingido. Tente novamente em X minutos"
      
- [ ] Dado que envio solicita√ß√£o com sucesso
      Quando verifico meu hist√≥rico
      Ent√£o solicita√ß√£o aparece em "Solicita√ß√µes enviadas"

##### Prioridade
**Alta** - Funcionalidade core de conex√£o

##### Complexidade
**M√©dia** - Valida√ß√µes m√∫ltiplas e rate limiting

##### Depend√™ncias
RF011 (Perfil), RF056 (Bot√£o)

##### Notas/Observa√ß√µes
- Tabela `friendships`: user_id, friend_id, status, created_at, updated_at
- Constraint: user_id < friend_id (evitar duplicatas reversas)
- Rate limiting em Redis: key = user_id:pending_requests
- Valida√ß√£o backend obrigat√≥ria (n√£o confiar s√≥ em frontend)
- Logs de todas as tentativas (auditoria)
- Considerar limite aumentado para usu√°rios com perfil completo



#### RF058 - Notifica√ß√£o de solicita√ß√£o de amizade recebida

##### User Story
Como **aluno que recebeu solicita√ß√£o de amizade**
Quero **ser notificado quando algu√©m me envia solicita√ß√£o**
Para **n√£o perder oportunidades de conex√£o e responder prontamente**

##### Descri√ß√£o
Sistema de notifica√ß√£o que alerta usu√°rio quando recebe nova solicita√ß√£o de amizade, com op√ß√µes de aceitar/recusar diretamente da notifica√ß√£o.

##### Regras de Neg√≥cio
- RN001: Notifica√ß√£o in-app imediata (badge no √≠cone de notifica√ß√µes)
- RN002: Email opcional com resumo (Fase 2)
- RN003: Notifica√ß√£o mostra foto, nome e universidade de quem enviou
- RN004: Bot√µes de a√ß√£o: "Aceitar", "Recusar", "Ver perfil"
- RN005: Marcar como lida ao clicar na notifica√ß√£o
- RN006: N√£o enviar notifica√ß√£o se usu√°rio j√° deletou/desativou conta
- RN007: Agrupamento: m√∫ltiplas solicita√ß√µes = notifica√ß√µes separadas

##### Crit√©rios de Aceita√ß√£o
- [ ] Dado que Jo√£o me envia solicita√ß√£o de amizade
      Quando solicita√ß√£o √© processada
      Ent√£o recebo notifica√ß√£o com foto e nome de Jo√£o
      
- [ ] Dado que vejo notifica√ß√£o
      Quando clico em "Aceitar" na notifica√ß√£o
      Ent√£o amizade √© confirmada sem precisar abrir perfil de Jo√£o
      
- [ ] Dado que vejo notifica√ß√£o
      Quando clico em "Ver perfil"
      Ent√£o sou redirecionado para perfil de Jo√£o com notifica√ß√£o marcada como lida
      
- [ ] Dado que recebi m√∫ltiplas solicita√ß√µes
      Quando visualizo notifica√ß√µes
      Ent√£o vejo cada uma separadamente com contador "3 novas solicita√ß√µes"
      
- [ ] Dado que desligo notifica√ß√µes de solicita√ß√µes de amizade
      Quando algu√©m me envia solicita√ß√£o
      Ent√£o ainda vejo in-app mas n√£o recebo push/email

##### Prioridade
**Alta** - Engajamento e reten√ß√£o

##### Complexidade
**M√©dia** - Sistema de notifica√ß√µes com m√∫ltiplos canais

##### Depend√™ncias
RF057 (Enviar solicita√ß√£o), RF169-RF182 (Sistema de notifica√ß√µes)

##### Notas/Observa√ß√µes
- Tabela `notifications`: user_id, actor_id, type, read, created_at
- Badge de contador no navbar
- Toast notification tamb√©m (opcional)
- Prefer√™ncias de notifica√ß√£o customiz√°veis no perfil
- N√£o notificar 2x se houver erro na primeira tentativa
- Logs de todas as notifica√ß√µes enviadas



#### RF059 - Aceitar solicita√ß√£o de amizade

##### User Story
Como **aluno que recebeu solicita√ß√£o de amizade**
Quero **aceitar a solicita√ß√£o de amizade**
Para **estabelecer conex√£o e ter acesso aos contatos do outro usu√°rio**

##### Descri√ß√£o
Funcionalidade que confirma solicita√ß√£o de amizade, alterando status para "accepted" e liberando acesso a informa√ß√µes privadas entre ambos.

##### Regras de Neg√≥cio
- RN001: Aceitar atualiza status da amizade para "accepted"
- RN002: Amizade fica bidirecional (ambos veem como amigos)
- RN003: Redes sociais s√£o liberadas automaticamente para ambos (RF019)
- RN004: Ambos recebem notifica√ß√£o de confirma√ß√£o (agora s√£o amigos)
- RN005: Aceitar remove outras solicita√ß√µes pendentes desse usu√°rio
- RN006: Timestamp de aceita√ß√£o √© registrado
- RN007: Limite de amizades: nenhum (aceitar quantos quiser)

##### Crit√©rios de Aceita√ß√£o
- [ ] Dado que vejo notifica√ß√£o de solicita√ß√£o
      Quando clico em "Aceitar"
      Ent√£o status muda para "amigos" e contatos s√£o liberados
      
- [ ] Dado que aceito solicita√ß√£o
      Quando visualizo perfil dele
      Ent√£o seus contatos (WhatsApp, Instagram) agora ficam vis√≠veis
      
- [ ] Dado que acei solicita√ß√£o
      Quando verifico meus amigos
      Ent√£o novo amigo aparece na lista
      
- [ ] Dado que acei solicita√ß√£o
      Quando o outro usu√°rio visualiza meu perfil
      Ent√£o tamb√©m v√™ meus contatos (bidirecional)
      
- [ ] Dado que acei solicita√ß√£o
      Quando verifico notifica√ß√µes
      Ent√£o recebo "Voc√™ e Jo√£o agora s√£o amigos! üéâ"

##### Prioridade
**Alta** - Core do sistema de amizades

##### Complexidade
**M√©dia** - Atualiza√ß√£o com triggers m√∫ltiplos

##### Depend√™ncias
RF057 (Solicita√ß√£o), RF019 (Libera√ß√£o de contatos), RF058 (Notifica√ß√£o)

##### Notas/Observa√ß√µes
- Update statement: UPDATE friendships SET status='accepted', updated_at=NOW()
- Trigger para liberar contatos automaticamente
- Notifica√ß√£o para ambos os usu√°rios
- Remo√ß√£o de outras solicita√ß√µes pendentes desse usu√°rio
- Logs de aceites para auditoria
- Valida√ß√£o: apenas receptor pode aceitar
- Considerar "Sugest√µes baseadas em novo amigo" (Fase 2)



#### RF060 - Recusar solicita√ß√£o de amizade

##### User Story
Como **aluno que recebeu solicita√ß√£o de amizade**
Quero **recusar a solicita√ß√£o de amizade**
Para **n√£o me conectar com usu√°rios que n√£o desejo**

##### Descri√ß√£o
Funcionalidade que rejeita solicita√ß√£o de amizade, mantendo registro com status "rejected" e impedindo novas tentativas por per√≠odo.

##### Regras de Neg√≥cio
- RN001: Recusar atualiza status para "rejected"
- RN002: Solicita√ß√£o rejeitada n√£o pode ser reenviada por 30 dias
- RN003: Rejei√ß√£o √© invis√≠vel (quem enviou n√£o sabe que foi rejeitado)
- RN004: Sem notifica√ß√£o para quem enviou (privacidade)
- RN005: Usu√°rio que recusou ainda pode iniciar amizade depois (novo pedido)
- RN006: Timestamp de rejei√ß√£o √© registrado
- RN007: Admin pode visualizar hist√≥rico de rejei√ß√µes (modera√ß√£o)

##### Crit√©rios de Aceita√ß√£o
- [ ] Dado que vejo solicita√ß√£o de amizade
      Quando clico em "Recusar"
      Ent√£o notifica√ß√£o √© removida e quem enviou n√£o recebe aviso
      
- [ ] Dado que recusei solicita√ß√£o
      Quando quem enviou tenta enviar novamente
      Ent√£o recebe erro "Voc√™ j√° enviou solicita√ß√£o recentemente. Tente novamente em X dias"
      
- [ ] Dado que recusei solicita√ß√£o h√° 31 dias
      Quando pessoa tenta enviar novamente
      Ent√£o solicita√ß√£o √© aceita (per√≠odo expirou)
      
- [ ] Dado que recusei solicita√ß√£o
      Quando eu pr√≥prio envio solicita√ß√£o depois
      Ent√£o √© permitido (eu posso iniciar)
      
- [ ] Dado que sou admin
      Quando visualizo hist√≥rico de rejei√ß√µes
      Ent√£o vejo todas com timestamps e usu√°rios envolvidos

##### Prioridade
**Alta** - Privacidade e controle do usu√°rio

##### Complexidade
**M√©dia** - Valida√ß√£o de tempo decorrido

##### Depend√™ncias
RF057 (Solicita√ß√£o), RF058 (Notifica√ß√£o)

##### Notas/Observa√ß√µes
- Tabela `friendships`: status = 'rejected'
- Campo `rejected_at` para timestamp
- L√≥gica: bloquear novo envio se rejected_at > NOW() - 30 dias
- Sem notifica√ß√£o (diferente de "bloquear")
- Rejei√ß√£o √© silenciosa (privacidade)
- Logs para modera√ß√£o (detectar padr√µes de ass√©dio)
- Considerar "block" na Fase 2 (permanente)



#### RF061 - Visualizar lista de amigos

##### User Story
Como **aluno cadastrado**
Quero **visualizar lista de todos os meus amigos**
Para **acompanhar minha rede e encontrar contatos r√°pido**

##### Descri√ß√£o
P√°gina ou se√ß√£o do perfil exibindo lista de todos os usu√°rios com quem tenho amizade confirmada, com filtros e op√ß√µes de intera√ß√£o.

##### Regras de Neg√≥cio
- RN001: Listar apenas amigos com status "accepted"
- RN002: Exibir: foto, nome, universidade, curso, 3 tags principais
- RN003: Ordena√ß√£o padr√£o: alfab√©tica por nome
- RN004: Filtro por universidade dispon√≠vel
- RN005: Busca por nome dispon√≠vel
- RN006: Bot√£o "Remover amizade" em cada card
- RN007: Contador total de amigos no topo

##### Crit√©rios de Aceita√ß√£o
- [ ] Dado que tenho 25 amigos
      Quando acesso "Meus Amigos"
      Ent√£o vejo lista com 25 cards mostrando foto, nome, universidade, curso
      
- [ ] Dado que amigos s√£o Jo√£o Silva, Ana Santos, Bruno Costa
      Quando visualizo lista
      Ent√£o aparecem em ordem alfab√©tica (Ana, Bruno, Jo√£o)
      
- [ ] Dado que filtr por universidade "USP"
      Quando aplico
      Ent√£o vejo apenas amigos que estudam na USP
      
- [ ] Dado que busco por "Jo√£o"
      Quando digito
      Ent√£o apenas Jo√£o aparece na lista (ou todos com Jo√£o no nome)
      
- [ ] Dado que clico no card de um amigo
      Quando interajo
      Ent√£o sou redirecionado para perfil dele

##### Prioridade
**Alta** - Gerenciamento de conex√µes

##### Complexidade
**Baixa** - Listagem simples com filtros

##### Depend√™ncias
RF059 (Aceitar amizade), RF010 (Perfil)

##### Notas/Observa√ß√µes
- Query: SELECT * FROM friendships WHERE (user_id=? OR friend_id=?) AND status='accepted'
- Pagina√ß√£o: 20 amigos por p√°gina
- Cards responsivos (grid 3-4 colunas)
- Link "Ver perfil" em cada card
- Compartilhar lista de amigos (opcional)
- Analytics: estat√≠sticas de rede (maior rede, etc)
- √çndice em (user_id, friend_id, status) para performance



#### RF062 - Visualizar solicita√ß√µes pendentes (enviadas)

##### User Story
Como **aluno que enviou solicita√ß√µes de amizade**
Quero **visualizar solicita√ß√µes que enviei e ainda est√£o pendentes**
Para **acompanhar o status e cancelar se necess√°rio**

##### Descri√ß√£o
P√°gina/se√ß√£o mostrando todas as solicita√ß√µes de amizade enviadas que ainda n√£o foram aceitas ou recusadas.

##### Regras de Neg√≥cio
- RN001: Listar apenas solicita√ß√µes com status "pending" enviadas por mim
- RN002: Exibir: foto, nome, universidade, status "Aguardando resposta"
- RN003: Ordena√ß√£o por data de envio (mais recente primeiro)
- RN004: Bot√£o "Cancelar solicita√ß√£o" em cada card
- RN005: Indicador de tempo decorrido ("enviado h√° 2 dias")
- RN006: Limite: mostrar solicita√ß√µes com at√© 90 dias
- RN007: Contador total de solicita√ß√µes pendentes

##### Crit√©rios de Aceita√ß√£o
- [ ] Dado que enviei solicita√ß√µes para 3 pessoas e nenhuma respondeu
      Quando acesso "Solicita√ß√µes Enviadas"
      Ent√£o vejo lista com 3 pessoas em status "Aguardando resposta"
      
- [ ] Dado que enviei solicita√ß√£o h√° 2 dias
      Quando visualizo
      Ent√£o vejo "Enviado h√° 2 dias" abaixo do nome
      
- [ ] Dado que clico em "Cancelar solicita√ß√£o"
      Quando confirmo
      Ent√£o solicita√ß√£o √© removida e pessoa n√£o v√™ mais a solicita√ß√£o dela
      
- [ ] Dado que enviei solicita√ß√£o h√° 91 dias
      Quando visualizo lista
      Ent√£o n√£o aparece (limite de 90 dias)
      
- [ ] Dado que uma pessoa aceitou minha solicita√ß√£o
      Quando verifico "Solicita√ß√µes Enviadas"
      Ent√£o aquela pessoa n√£o aparece (movida para "Amigos")

##### Prioridade
**M√©dia** - Gerenciamento de estado

##### Complexidade
**Baixa** - Filtro simples por status

##### Depend√™ncias
RF057 (Enviar solicita√ß√£o), RF059 (Aceitar)

##### Notas/Observa√ß√µes
- Query: SELECT * FROM friendships WHERE user_id=? AND status='pending'
- Cards em layout listagem ou grid
- Tempo decorrido calculado: NOW() - created_at
- Limpeza autom√°tica: solicita√ß√µes >90 dias podem ser deletadas (opcional)
- Bot√£o "Cancelar" dispara soft delete ou status='cancelled'
- Toast notification: "Solicita√ß√£o cancelada"
- Considerar "Reenviar solicita√ß√£o" se foi recusada (Fase 2)



#### RF063 - Visualizar solicita√ß√µes pendentes (recebidas)

##### User Story
Como **aluno que recebeu solicita√ß√µes de amizade**
Quero **visualizar todas as solicita√ß√µes que recebi e ainda n√£o respondi**
Para **aceitar ou recusar conforme desejo**

##### Descri√ß√£o
P√°gina/se√ß√£o mostrando todas as solicita√ß√µes de amizade recebidas pendentes de resposta com op√ß√µes de aceitar ou recusar direto.

##### Regras de Neg√≥cio
- RN001: Listar apenas solicita√ß√µes com status "pending" recebidas por mim
- RN002: Exibir: foto, nome, universidade, curso, tags, bot√µes Aceitar/Recusar
- RN003: Ordena√ß√£o por data de recebimento (mais recente primeiro)
- RN004: Indicador de tempo decorrido ("recebido h√° 5 dias")
- RN005: Bot√µes de a√ß√£o diretos: "Aceitar", "Recusar", "Ver Perfil"
- RN006: Contador total de solicita√ß√µes pendentes (no √≠cone de notifica√ß√µes)
- RN007: Limite: mostrar solicita√ß√µes com at√© 90 dias

##### Crit√©rios de Aceita√ß√£o
- [ ] Dado que recebi solicita√ß√µes de 5 pessoas
      Quando acesso "Solicita√ß√µes Recebidas"
      Ent√£o vejo lista com 5 cards mostrando foto, nome, universidade, curso
      
- [ ] Dado que vejo solicita√ß√£o
      Quando clico em "Aceitar" diretamente
      Ent√£o amizade √© confirmada sem abrir perfil
      
- [ ] Dado que vejo solicita√ß√£o
      Quando clico em "Ver Perfil"
      Ent√£o sou redirecionado para perfil da pessoa (posso decidir depois)
      
- [ ] Dado que recebi solicita√ß√£o h√° 3 dias
      Quando visualizo
      Ent√£o vejo "Recebido h√° 3 dias" abaixo do nome
      
- [ ] Dado que tenho 2 solicita√ß√µes pendentes
      Quando visualizo navbar
      Ent√£o vejo badge "2" no √≠cone de notifica√ß√µes

##### Prioridade
**Alta** - Gerenciamento de entrada

##### Complexidade
**Baixa** - Filtro simples com a√ß√µes r√°pidas

##### Depend√™ncias
RF057 (Receber solicita√ß√£o), RF059-RF060 (Aceitar/Recusar)

##### Notas/Observa√ß√µes
- Query: SELECT * FROM friendships WHERE friend_id=? AND status='pending'
- Cards em layout de grid ou listagem
- Bot√µes lado a lado: [Aceitar] [Recusar] com hover interativo
- Badge de contador no navbar atualizado em tempo real
- Limpeza autom√°tica de solicita√ß√µes >90 dias (opcional)
- Toast: "Solicita√ß√£o aceita! Agora voc√™s s√£o amigos üéâ"
- Considerar "Sugerir amigos m√∫tuos" ao aceitar



#### RF064 - Remover amizade

##### User Story
Como **aluno**
Quero **remover amizade com outro aluno**
Para **desfazer conex√£o se mudarmos de rela√ß√£o ou prefer√™ncias**

##### Descri√ß√£o
Funcionalidade que desfaz amizade bidirecional, removendo conex√£o e ocultando contatos novamente.

##### Regras de Neg√≥cio
- RN001: Remover amizade √© bidirecional (ambos perdem amizade)
- RN002: Confirma√ß√£o obrigat√≥ria antes de remover
- RN003: Redes sociais voltam a ficar ocultas ap√≥s remo√ß√£o (RF018)
- RN004: Soft delete: registro mantido com status "removed"
- RN005: Nenhuma notifica√ß√£o para outro usu√°rio (privacidade)
- RN006: Ambos podem remover amizade independentemente
- RN007: Ap√≥s remover, √© poss√≠vel enviar nova solicita√ß√£o

##### Crit√©rios de Aceita√ß√£o
- [ ] Dado que sou amigo de Jo√£o
      Quando clico em "Remover amizade"
      Ent√£o vejo modal de confirma√ß√£o
      
- [ ] Dado que confirmo remo√ß√£o
      Quando a√ß√£o √© processada
      Ent√£o Jo√£o e eu deixamos de ser amigos mutuamente
      
- [ ] Dado que removo amizade
      Quando Jo√£o visualiza meu perfil
      Ent√£o meus contatos (WhatsApp, Instagram) voltam a ficar ocultos
      
- [ ] Dado que removo amizade com Jo√£o
      Quando quero me conectar novamente
      Ent√£o posso enviar nova solicita√ß√£o (sem bloqueio de 30 dias)
      
- [ ] Dado que removo amizade
      Quando Jo√£o recebe notifica√ß√£o
      Ent√£o n√£o recebe (privacidade)

##### Prioridade
**M√©dia** - Importante mas menos cr√≠tico

##### Complexidade
**Baixa** - Update simples com status

##### Depend√™ncias
RF061 (Visualizar amigos), RF059 (Aceitar amizade)

##### Notas/Observa√ß√µes
- Update: SET status='removed', removed_at=NOW()
- Soft delete mant√©m auditoria completa
- Modal de confirma√ß√£o: "Tem certeza que deseja remover?"
- Toast: "Amizade removida"
- Sem notifica√ß√£o para outro usu√°rio (diferente de rejeitar)
- Ambos podem remover independentemente (pode haver inconsist√™ncia breve)
- Considerar "bloquear" permanentemente na Fase 2



#### RF065 - Busca na lista de amigos

##### User Story
Como **aluno com muitos amigos**
Quero **buscar amigos por nome**
Para **encontrar contato espec√≠fico rapidamente**

##### Descri√ß√£o
Campo de busca na p√°gina de amigos permitindo filtrar lista por nome parcial ou completo em tempo real.

##### Regras de Neg√≥cio
- RN001: Busca case-insensitive
- RN002: Busca por nome completo ou parcial (ex: "Jo√£o" encontra "Jo√£o Silva")
- RN003: Resultados atualizados em tempo real conforme digita
- RN004: Termo m√≠nimo: 2 caracteres
- RN005: Busca tamb√©m em universidade/curso (opcional)
- RN006: Contador de resultados exibido
- RN007: Limpar busca: bot√£o X no campo ou ESC

##### Crit√©rios de Aceita√ß√£o
- [ ] Dado que tenho 50 amigos
      Quando digito "Jo√£o" no campo de busca
      Ent√£o vejo 3 amigos com Jo√£o no nome (ex: Jo√£o Silva, Jo√£o Pereira, Maria Jo√£o)
      
- [ ] Dado que digito "J"
      Quando digito
      Ent√£o vejo mensagem "Digite ao menos 2 caracteres"
      
- [ ] Dado que digito "jo√£o" (min√∫scula)
      Quando busca processa
      Ent√£o resultados s√£o iguais a "Jo√£o" (case-insensitive)
      
- [ ] Dado que digito "USP"
      Quando busca processa (em universidade)
      Ent√£o vejo todos amigos que estudam na USP
      
- [ ] Dado que clico em X ou teclo ESC
      Quando interajo
      Ent√£o busca √© limpa e vejo todos amigos novamente

##### Prioridade
**M√©dia** - UX melhor mas n√£o bloqueia

##### Complexidade
**Baixa** - Filtro de string simples

##### Depend√™ncias
RF061 (Visualizar amigos), RF065 (Busca)

##### Notas/Observa√ß√µes
- Campo de busca no topo da lista de amigos
- Debounce 300ms para n√£o sobrecarregar
- Filtro local (JavaScript) se <200 amigos
- Filtro servidor se >200 amigos
- Placeholder: "Buscar amigo por nome..."
- √çcone de lupa e X (limpar)
- Highlighting de termo encontrado no resultado
- Considerar autocomplete com hist√≥rico (Fase 2)



#### RF066 - Prevenir envio de m√∫ltiplas solicita√ß√µes para mesma pessoa

##### User Story
Como **sistema ISMART Conecta**
Quero **impedir envio de m√∫ltiplas solicita√ß√µes para mesma pessoa**
Para **evitar spam e confus√£o de status**

##### Descri√ß√£o
Valida√ß√£o que bloqueia novo envio de solicita√ß√£o se j√° existe uma pendente, aceita ou recusada recentemente.

##### Regras de Neg√≥cio
- RN001: Verifica√ß√£o bidirecional: n√£o pode existir solicita√ß√£o de qualquer dire√ß√£o
- RN002: Bloqueio se solicita√ß√£o "pending" existe
- RN003: Bloqueio por 30 dias se solicita√ß√£o foi "rejected"
- RN004: Permitir novo envio se solicita√ß√£o foi "accepted" e depois "removed"
- RN005: Valida√ß√£o no frontend (UX) e backend (seguran√ßa)
- RN006: Mensagem clara explicando por que n√£o pode enviar
- RN007: Logs de tentativas bloqueadas para auditoria

##### Crit√©rios de Aceita√ß√£o
- [ ] Dado que j√° enviei solicita√ß√£o para Jo√£o e est√° pendente
      Quando tento enviar outra
      Ent√£o vejo erro "Voc√™ j√° enviou solicita√ß√£o para este aluno"
      
- [ ] Dado que Jo√£o recusou minha solicita√ß√£o h√° 5 dias
      Quando tento enviar novamente
      Ent√£o vejo erro "Voc√™ j√° enviou solicita√ß√£o recentemente. Tente novamente em 25 dias"
      
- [ ] Dado que somos amigos e removi a amizade
      Quando tento enviar nova solicita√ß√£o
      Ent√£o √© permitido (bloqueio anterior expirou)
      
- [ ] Dado que tento enviar solicita√ß√£o via API direta (burlar frontend)
      Quando backend valida
      Ent√£o retorna erro 409 "Solicita√ß√£o j√° existe"
      
- [ ] Dado que sistemas tenta adicionar para mesma pessoa 2 vezes rapidamente
      Quando segunda requisi√ß√£o chega
      Ent√£o rejeita por constraint UNIQUE

##### Prioridade
**Alta** - Requisito cr√≠tico de integridade

##### Complexidade
**M√©dia** - Valida√ß√µes m√∫ltiplas e timing

##### Depend√™ncias
RF057 (Enviar solicita√ß√£o), RF060 (Recusar)

##### Notas/Observa√ß√µes
- Constraint UNIQUE no banco: (MIN(user_id, friend_id), MAX(user_id, friend_id))
- Valida√ß√£o bidirecional: WHERE (user_id=? AND friend_id=?) OR (user_id=? AND friend_id=?)
- L√≥gica de tempo: IF status='rejected' AND NOW()-updated_at < 30 DAYS THEN BLOCK
- Frontend desabilita bot√£o se j√° existe solicita√ß√£o
- Toast/mensagem clara: "Voc√™ j√° tem uma solicita√ß√£o pendente com este aluno"
- Logs de tentativas bloqueadas (detectar comportamento an√¥malo)
- Considerar limite din√¢mico baseado em reputa√ß√£o do usu√°rio



#### RF067 - Libera√ß√£o autom√°tica de contatos ap√≥s aceite m√∫tuo

##### User Story
Como **aluno que aceitou amizade**
Quero **que os contatos (WhatsApp, Instagram, LinkedIn) se liberem automaticamente**
Para **poder entrar em contato imediatamente com meu novo amigo**

##### Descri√ß√£o
Trigger autom√°tico que, ap√≥s aceitar ou ser aceito em solicita√ß√£o de amizade, libera imediatamente a visualiza√ß√£o de redes sociais para ambos os usu√°rios, sem necessidade de a√ß√£o manual.

##### Regras de Neg√≥cio
- RN001: Libera√ß√£o ocorre instantaneamente ap√≥s status mudar para "accepted"
- RN002: Libera√ß√£o √© bidirecional (ambos veem contatos um do outro)
- RN003: Requer que perfil de ambos tenha redes sociais cadastradas
- RN004: Se um n√£o preencheu redes sociais, mostra mensagem "Usu√°rio n√£o adicionou [rede]"
- RN005: Remo√ß√£o de amizade reverte libera√ß√£o (contatos voltam ocultos)
- RN006: Update de contatos ativa libera√ß√£o para todos amigos existentes
- RN007: Sem notifica√ß√£o espec√≠fica (j√° h√° notifica√ß√£o de amizade confirmada)

##### Crit√©rios de Aceita√ß√£o
- [ ] Dado que aceito solicita√ß√£o de amizade de Jo√£o
      Quando aceita√ß√£o √© processada
      Ent√£o imediatamente vejo WhatsApp e Instagram de Jo√£o
      
- [ ] Dado que Jo√£o visualiza meu perfil ap√≥s aceita√ß√£o
      Quando carrega
      Ent√£o ele tamb√©m v√™ meus contatos instantaneamente (sem refresh)
      
- [ ] Dado que n√£o preenchei WhatsApp no meu perfil
      Quando Jo√£o v√™ meu perfil como amigo
      Ent√£o aparece "Usu√°rio n√£o adicionou WhatsApp ainda"
      
- [ ] Dado que removo amizade com Jo√£o
      Quando remo√ß√£o √© processada
      Ent√£o contatos voltam a ficar ocultos imediatamente
      
- [ ] Dado que adiciono novo n√∫mero de WhatsApp ao meu perfil
      Quando salvo
      Ent√£o todos meus amigos veem o novo contato instantaneamente

##### Prioridade
**Alta** - Fluxo core de conex√£o

##### Complexidade
**M√©dia** - Requer trigger e atualiza√ß√£o em tempo real

##### Depend√™ncias
RF017-RF019 (Redes sociais e libera√ß√£o), RF059 (Aceitar amizade), RF064 (Remover amizade)

##### Notas/Observa√ß√µes
- Trigger no backend: ON UPDATE friendships SET status='accepted' THEN trigger libera√ß√£o
- Campo na view `friends_with_contacts`: dados_sociais vis√≠veis apenas se amigos
- WebSocket para atualiza√ß√£o em tempo real (opcional, sen√£o query nova ao carregar)
- Toast notification: "Agora voc√™ pode ver os contatos de Jo√£o!"
- Verifica√ß√£o de visualiza√ß√£o: query JOIN friendships WHERE status='accepted'
- Logs de libera√ß√£o (auditoria de dados sens√≠veis)
- Considerar "notifica√ß√£o" quando novo amigo te v√™ pela primeira vez (Fase 2)