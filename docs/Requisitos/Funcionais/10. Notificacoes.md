#### RF169 - Notificação de novo comentário em thread que participou

##### User Story
Como **usuário que participou de uma thread**
Quero **receber notificação quando alguém comenta em uma thread onde já comentei**
Para **acompanhar discussão e não perder respostas relevantes**

##### Descrição
Sistema automático de notificações que envia alerta (in-app + email opcional) quando novo comentário é adicionado a thread onde usuário participou. Inclui preview do comentário e link direto.

##### Regras de Negócio
- RN001: Notificar apenas se usuário tem "comentários em threads" ativado nas preferências
- RN002: Não notificar se próprio usuário é quem comentou
- RN003: Não notificar comentários removidos por moderação
- RN004: Máximo 1 notificação por thread por dia (agrupar múltiplos comentários)
- RN005: Incluir no notification_type para categorização
- RN006: Armazenar em tabela `notifications` com referência ao comentário

##### Critérios de Aceitação
- [ ] Dado que participei de thread "Dúvida Python"
      Quando alguém comenta nessa thread
      Então recebo notificação in-app: "Novo comentário em 'Dúvida Python'"
      
- [ ] Dado que notificação é enviada
      Quando visualizo
      Então vejo preview do comentário (primeiras 100 caracteres) + autor
      
- [ ] Dado que clico em notificação
      Quando redirecionado
      Então acesso thread + novo comentário é destacado
      
- [ ] Dado que 3 pessoas comentam na thread em 1 hora
      Quando verifico notificações
      Então vejo 1 notificação agrupada: "3 novos comentários em 'Dúvida Python'"
      
- [ ] Dado que desabilito "Notificações de comentários" nas preferências
      Quando alguém comenta
      Então nenhuma notificação é enviada
      
- [ ] Dado que notificação é criada
      Quando verifico banco de dados
      Então registro contém: user_id, thread_id, comment_id, notification_type, created_at

##### Prioridade
**Alta** - Engajamento essencial

##### Complexidade
**Média** - Trigger com agregação

##### Dependências
RF027 (Comentar), RF179 (Central de notificações)

##### Notas/Observações
- Trigger: ON INSERT comments THEN enviar notificação a participantes
- Tabela `notifications`: id, user_id, notification_type, related_id, content, is_read, created_at
- Agregação: IF comentário em thread com notificação aberta nas últimas 24h ENTÃO atualizar (count++)
- Email: enviar apenas se preferência "Email notifications" está ativa
- Delay: enviar notificação com 5-10s de delay (permitir edição rápida)
- Exclusão: não notificar próprio criador da thread
- Considerar "Mute thread" para desabilitar notificações de thread específica



#### RF170 - Notificação de solicitação de amizade recebida

##### User Story
Como **usuário que recebe solicitação de amizade**
Quero **ser notificado quando alguém envia solicitação de amizade**
Para **não perder convites de conectar com outros alunos**

##### Descrição
Notificação in-app + email opcional quando solicitação de amizade é recebida. Inclui nome, foto, universidade do solicitante e ações rápidas (aceitar/recusar).

##### Regras de Negócio
- RN001: Enviar apenas se preferência "Notificações de amizade" está ativa
- RN002: Não notificar se já são amigos
- RN003: Não notificar se já existe solicitação pendente (bidirecional)
- RN004: Incluir ações inline: "Aceitar" / "Recusar" (sem abrir outra página)
- RN005: notification_type: "friend_request_received"
- RN006: Armazenar: user_id, friend_request_id, is_read

##### Critérios de Aceitação
- [ ] Dado que João envia solicitação de amizade para Maria
      Quando solicitação é processada
      Então Maria recebe notificação: "João Silva enviou solicitação de amizade"
      
- [ ] Dado que notificação é exibida
      Quando visualizo
      Então vejo: foto de João, nome, universidade + botões "Aceitar" e "Recusar"
      
- [ ] Dado que clico em "Aceitar" na notificação
      Quando ação processa
      Então amizade é confirmada sem recarregar página
      
- [ ] Dado que clico em "Recusar"
      Quando confirmo
      Então solicitação é rejeitada e notificação desaparece
      
- [ ] Dado que desabilito notificações de amizade
      Quando recebo nova solicitação
      Então nenhuma notificação é enviada
      
- [ ] Dado que verifico histórico de notificações
      Quando acesso Central de Notificações
      Então vejo todas solicitações recebidas

##### Prioridade
**Alta** - Conexão de usuários

##### Complexidade
**Média** - Notificação com ações inline

##### Dependências
RF057 (Enviar solicitação de amizade)

##### Notas/Observações
- Trigger: ON INSERT friend_requests THEN enviar notificação
- Validação: verificar status existing (não duplicar se pendente)
- Ações inline: AJAX calls para aceitar/recusar sem redireção
- Foto/avatar: incluir thumbnail 48x48px na notificação
- Email template: personalizado com foto e botão de ação
- Dismiss: usuário pode fechar notificação sem aceitar/recusar
- Considerar "Auto-decline após 7 dias" (Fase 2)



#### RF171 - Notificação de amizade aceita

##### User Story
Como **usuário que enviou solicitação de amizade**
Quero **ser notificado quando minha solicitação é aceita**
Para **saber que consigo conectar com novo aluno e visualizar contatos liberados**

##### Descrição
Notificação in-app + email opcional informando que solicitação de amizade foi aceita. Inclui nome do novo amigo, foto e ação rápida "Ver contatos" ou "Iniciar conversa".

##### Regras de Negócio
- RN001: Enviar apenas se preferência "Notificações de amizade" ativa
- RN002: notification_type: "friend_request_accepted"
- RN003: Incluir foto, nome, universidade do novo amigo
- RN004: Ações: "Ver Perfil" ou "Ver Contatos" (se contatos liberados)
- RN005: Armazenar: user_id, friend_id, is_read, created_at

##### Critérios de Aceitação
- [ ] Dado que Maria aceita solicitação de João
      Quando ação processa
      Então João recebe notificação: "Maria Silva aceitou sua solicitação de amizade"
      
- [ ] Dado que notificação é exibida
      Quando visualizo
      Então vejo foto de Maria + nome + universidade + botão "Ver Perfil"
      
- [ ] Dado que clico em "Ver Perfil"
      Quando ação executa
      Então redirecionado para perfil de Maria
      
- [ ] Dado que contatos foram liberados
      Quando visualizo notificação
      Então vejo botão adicional "Ver Contatos" (WhatsApp, Instagram, LinkedIn)
      
- [ ] Dado que verifico notificações
      Quando acesso Central
      Então vejo histórico de todas amizades aceitas

##### Prioridade
**Alta** - Confirmação de conexão

##### Complexidade
**Baixa** - Notificação simples

##### Dependências
RF060 (Aceitar solicitação de amizade), RF171 (Liberar contatos)

##### Notas/Observações
- Trigger: ON UPDATE friend_requests SET status='accepted'
- Email: template celebrando nova amizade
- Contatos liberados: buscar dados de RF067 (liberar contatos)
- Foto: thumbnail 48x48px com border circular
- CTA forte: botão primário "Ver Perfil"



#### RF172 - Notificação de novo mentorado (para mentores)

##### User Story
Como **mentor na plataforma**
Quero **ser notificado quando um aluno é atribuído como mentorado**
Para **acompanhar novos mentorados e preparar próximas sessões**

##### Descrição
Notificação in-app + email informando mentor sobre novo mentorado atribuído. Inclui nome, universidade, curso do mentorado e área de mentoria. Oferece ação rápida "Ver Perfil" ou "Agendar Sessão".

##### Regras de Negócio
- RN001: Enviar apenas se preferência "Notificações de mentoria" ativa
- RN002: notification_type: "new_mentee_assigned"
- RN003: Incluir: nome mentorado, universidade, curso, área mentoria
- RN004: Ações: "Ver Perfil Mentorado" e "Agendar Primeira Sessão"
- RN005: Armazenar: mentor_id, mentorship_id, mentee_id, is_read

##### Critérios de Aceitação
- [ ] Dado que sistema atribui novo mentorado para João (mentor)
      Quando atribuição processa
      Então João recebe notificação: "Novo mentorado atribuído: Maria Silva"
      
- [ ] Dado que notificação é exibida
      Quando visualizo
      Então vejo: nome, universidade, curso, área mentoria + foto
      
- [ ] Dado que clico em "Ver Perfil Mentorado"
      Quando ação executa
      Então acesso perfil completo de Maria
      
- [ ] Dado que clico em "Agendar Primeira Sessão"
      Quando modal abre
      Então vejo calendário para escolher data/hora
      
- [ ] Dado que desabilito notificações de mentoria
      Quando novo mentorado é atribuído
      Então nenhuma notificação é enviada

##### Prioridade
**Média** - Programa de mentoria

##### Complexidade
**Baixa** - Notificação com ações

##### Dependências
RF (Sistema de mentoria)

##### Notas/Observações
- Trigger: ON INSERT mentorships
- Email: template apresentando mentorado
- Foto: avatar do mentorado em 48x48px
- Calendário: integração com RF (agendamento de sessões)
- Considerar "Lembrete 24h antes primeira sessão"



#### RF173 - Notificação de mentor atribuído (para mentorados)

##### User Story
Como **mentorado que recebi um mentor**
Quero **ser notificado quando um mentor é atribuído para me ajudar**
Para **saber com quem estarei trabalhando e preparar primeira sessão**

##### Descrição
Notificação in-app + email informando mentorado sobre mentor atribuído. Inclui nome, especialidade, universidade do mentor e contatos (se liberados). Oferece ações "Ver Perfil" ou "Enviar Mensagem".

##### Regras de Negócio
- RN001: Enviar apenas se preferência "Notificações de mentoria" ativa
- RN002: notification_type: "mentor_assigned"
- RN003: Incluir: nome mentor, especialidade, universidade
- RN004: Se contatos liberados: mostrar WhatsApp/Email do mentor
- RN005: Ações: "Ver Perfil Mentor" e "Enviar Mensagem" (se chat existir)
- RN006: Armazenar: mentee_id, mentorship_id, mentor_id, is_read

##### Critérios de Aceitação
- [ ] Dado que sistema atribui mentor para Maria (mentorada)
      Quando atribuição processa
      Então Maria recebe notificação: "Seu mentor foi atribuído: João Silva"
      
- [ ] Dado que notificação é exibida
      Quando visualizo
      Então vejo: nome mentor, especialidade (ex: Python/Web), universidade
      
- [ ] Dado que contatos do mentor foram liberados
      Quando visualizo notificação
      Então vejo WhatsApp e Email para contato direto
      
- [ ] Dado que clico em "Ver Perfil Mentor"
      Quando ação executa
      Então acesso perfil completo de João
      
- [ ] Dado que clico em "Enviar Mensagem"
      Quando chat abre
      Então posso enviar mensagem inicial para mentor

##### Prioridade
**Média** - Programa de mentoria

##### Complexidade
**Baixa** - Notificação com ações

##### Dependências
RF (Sistema de mentoria e chat)

##### Notas/Observações
- Trigger: ON INSERT mentorships THEN enviar para mentorado
- Email: apresentação do mentor com foto
- Contatos: buscar de RF067 (contatos liberados)
- Chat: integração com sistema de mensageria
- Foto: avatar do mentor em 48x48px



#### RF174 - Notificação de evento próximo (24h antes)

##### User Story
Como **usuário inscrito em evento**
Quero **receber lembrete 24 horas antes do evento começar**
Para **não esquecer e garantir presença**

##### Descrição
Notificação automática acionada 24 horas antes de evento começar. Inclui nome do evento, data/hora, local e botão "Confirmar Presença" ou "Ver Detalhes". Pode ser enviada via email + in-app.

##### Regras de Negócio
- RN001: Enviar apenas se preferência "Lembrete de eventos" ativa
- RN002: Enviar automaticamente 24 horas antes (job agendado)
- RN003: Apenas para usuários com status "registered" ou "confirmed"
- RN004: notification_type: "event_reminder_24h"
- RN005: Não enviar se evento foi cancelado
- RN006: Incluir link direto para detalhe do evento
- RN007: Armazenar: user_id, event_id, notification_type, is_read

##### Critérios de Aceitação
- [ ] Dado que me inscrevi em evento "Workshop Python" em 20/10 às 14:00
      Quando chega 19/10 às 14:00 (24h antes)
      Então recebo notificação: "Lembrete: Workshop Python amanhã às 14:00"
      
- [ ] Dado que notificação é enviada
      Quando visualizo
      Então vejo: título, data/hora, local + botão "Ver Detalhes"
      
- [ ] Dado que clico em notificação
      Quando ação executa
      Então acesso página de detalhe do evento
      
- [ ] Dado que desabilito "Lembrete de eventos"
      Quando 24h antes
      Então nenhuma notificação é enviada
      
- [ ] Dado que evento foi cancelado
      Quando 24h antes (se still within window)
      Então notificação não é enviada

##### Prioridade
**Alta** - Reduzir faltas

##### Complexidade
**Média** - Job scheduler + query

##### Dependências
RF145 (Eventos criados), RF (Inscrição em eventos)

##### Notas/Observações
- Job scheduler: executar diariamente (06:00) verificando eventos com start_date = NOW() + 24h
- Query: SELECT * FROM event_registrations WHERE event_id IN (SELECT id FROM events WHERE start_date = DATE_ADD(NOW(), INTERVAL 24 HOUR))
- Email: template com detalhes do evento + mapa (se tiver local)
- Confirmação: allow "Confirmar Presença" na notificação sem abrir evento
- Considerar "Lembrete 1 hora antes" (Fase 2)



#### RF175 - Notificação de cancelamento de evento

##### User Story
Como **usuário inscrito em evento que foi cancelado**
Quero **ser imediatamente notificado do cancelamento**
Para **não ir até o local e reorganizar meu tempo**

##### Descrição
Notificação urgente (in-app + email) enviada imediatamente quando evento é cancelado. Inclui motivo do cancelamento, data/hora original e opção de reembolso (se aplicável).

##### Regras de Negócio
- RN001: Enviar para TODOS inscritos no evento (status registered/confirmed/attended)
- RN002: notification_type: "event_cancelled"
- RN003: Prioridade alta (alert/urgent)
- RN004: Incluir motivo do cancelamento
- RN005: Se evento era pago: informar sobre reembolso/crédito
- RN006: Incluir email do organizador para dúvidas
- RN007: Enviar imediatamente (não aguardar job agendado)

##### Critérios de Aceitação
- [ ] Dado que evento "Python Workshop" é cancelado por admin
      Quando cancelamento processa
      Então todos inscritos recebem notificação: "Evento cancelado: Python Workshop"
      
- [ ] Dado que notificação é exibida
      Quando visualizo
      Então vejo: motivo cancelamento, data/hora original + email organizador
      
- [ ] Dado que evento era pago
      Quando recebo notificação
      Então vejo: "Seu pagamento será reembolsado em até 3 dias úteis"
      
- [ ] Dado que clico em "Contatar Organizador"
      Quando ação executa
      Então abro email pré-preenchido para organizador
      
- [ ] Dado que verifico notificações
      Quando acesso Central
      Então vejo notificação de cancelamento

##### Prioridade
**Alta** - Informação crítica

##### Complexidade
**Média** - Batch notification com email

##### Dependências
RF161 (Cancelar eventos), RF (Inscrição em eventos)

##### Notas/Observações
- Trigger: ON UPDATE events SET status='cancelled'
- Query: SELECT user_id FROM event_registrations WHERE event_id=?
- Email: template urgente com destaque em vermelho
- Tipo: "alert" (não agrupável, sempre mostra)
- Reembolso: buscar lógica de pagamentos
- Considerar "SMS" para eventos críticos (Fase 2)



#### RF176 - Notificação de conquista de badge

##### User Story
Como **usuário que conquistou uma badge**
Quero **ser notificado quando ganho uma badge**
Para **celebrar conquista e ser motivado a continuar engajado**

##### Descrição
Notificação celebratória in-app + email quando usuário conquista badge (automática ou atribuída manualmente). Inclui nome da badge, ícone, descrição e opção de compartilhar em redes sociais.

##### Regras de Negócio
- RN001: Enviar automaticamente quando badge é conquistada
- RN002: notification_type: "badge_achieved"
- RN003: Prioridade: normal
- RN004: Incluir ícone, nome, descrição da badge
- RN005: Ação: "Ver Badge" e "Compartilhar" (redes sociais)
- RN006: Armazenar: user_id, badge_id, is_read, created_at
- RN007: Não enviar email por padrão (apenas in-app), mas permitir opção

##### Critérios de Aceitação
- [ ] Dado que usuário conquista badge "Python Expert"
      Quando critério é atingido
      Então recebe notificação: "🏆 Parabéns! Você conquistou a badge 'Python Expert'"
      
- [ ] Dado que notificação é exibida
      Quando visualizo
      Então vejo: ícone, nome, descrição + "Compartilhar"
      
- [ ] Dado que clico em "Compartilhar"
      Quando menu abre
      Então vejo opções: LinkedIn, Twitter, Copiar link
      
- [ ] Dado que clico em "Ver Badge"
      Quando ação executa
      Então acesso perfil com todas badges conquistadas
      
- [ ] Dado que notificação é criada
      Quando verifico banco
      Então registro contém badge_id + referência correta

##### Prioridade
**Alta** - Gamificação e motivação

##### Complexidade
**Baixa** - Notificação simples com ações

##### Dependências
RF151 (Criar badge), RF156 (Atribuir badge)

##### Notas/Observações
- Trigger: ON INSERT user_badges
- Email: template celebrativo com GIF animado (opcional)
- Compartilhamento: pre-fill texto "Acabei de conquistar a badge Python Expert em [plataforma]"
- Som: som de celebração ao exibir notificação (se som ativado nas preferências)
- Considerar "Rarity animation" para badges raras (efeito visual especial)



#### RF177 - Notificação de upvote em thread/comentário próprio

##### User Story
Como **autor de thread ou comentário**
Quero **ser notificado quando alguém dá upvote no meu conteúdo**
Para **saber que meu conteúdo é útil e me motivar a continuar contribuindo**

##### Descrição
Notificação in-app (sem email por padrão) quando usuário recebe upvotes em thread ou comentário. Inclui contador de upvotes, preview do conteúdo e link direto. Agrupa múltiplos upvotes do mesmo conteúdo.

##### Regras de Negócio
- RN001: Enviar apenas se preferência "Notificações de upvote" ativa
- RN002: Não notificar upvote próprio (não possível)
- RN003: Agregar: máximo 1 notificação por conteúdo por dia
- RN004: notification_type: "upvote_received"
- RN005: Incluir: contador de upvotes, preview (50 caracteres), link
- RN006: Apenas in-app (não email, exceto se configurado)
- RN007: Armazenar: user_id, thread_id OR comment_id, upvote_count, is_read

##### Critérios de Aceitação
- [ ] Dado que meu comentário recebe upvote
      Quando upvote é registrado
      Então recebo notificação: "👍 Seu comentário recebeu um upvote"
      
- [ ] Dado que recebo 5 upvotes no mesmo comentário em 1 hora
      Quando visualizo notificações
      Então vejo 1 notificação: "👍 Seu comentário recebeu 5 upvotes"
      
- [ ] Dado que notificação é exibida
      Quando visualizo
      Então vejo preview do conteúdo + contador "5 👍"
      
- [ ] Dado que clico em notificação
      Quando redirecionado
      Então acesso thread/comentário com upvotes destacados
      
- [ ] Dado que desabilito notificações de upvote
      Quando recebo novo upvote
      Então nenhuma notificação é enviada

##### Prioridade
**Média** - Motivação de engajamento

##### Complexidade
**Média** - Agregação com lógica de batch

##### Dependências
RF030 (Upvote em threads), RF032 (Upvote em comentários)

##### Notas/Observações
- Trigger: ON INSERT votes (vote_type='up')
- Agregação: IF notificação aberta para mesmo conteúdo (últimas 24h) THEN atualizar count
- Email: desabilitar por padrão, permitir opt-in nas preferências
- Preview: primeiros 50 caracteres do conteúdo
- Link direto: ir para thread + destacar comentário/thread votada
- Considerar "Top comentários" notificação quando atinge X upvotes (Fase 2)



#### RF178 - Notificação de menção em comentário

##### User Story
Como **usuário mencionado em comentário**
Quero **ser notificado quando alguém me menciona (usando @)**
Para **participar da conversa e responder menções relevantes**

##### Descrição
Notificação in-app + email opcional quando usuário é mencionado usando @ em comentário. Inclui nome do mencionador, thread, preview do comentário e ação "Responder Menção".

##### Regras de Negócio
- RN001: Enviar quando formato @username é detectado no comentário
- RN002: Apenas 1 notificação por menção (não duplicar)
- RN003: notification_type: "mention_in_comment"
- RN004: Incluir: nome mencionador, thread, preview comentário
- RN005: Ação: "Ver Menção" (link direto)
- RN006: Email opcional (preferência do usuário)
- RN007: Não notificar auto-mentions (usuário mencionando a si mesmo)

##### Critérios de Aceitação
- [ ] Dado que João comenta em thread e escreve "@Maria dúvida importante"
      Quando comentário é publicado
      Então Maria recebe notificação: "João te mencionou em 'Dúvida Python'"
      
- [ ] Dado que notificação é exibida
      Quando visualizo
      Então vejo: nome, thread, preview comentário com @Maria destacado
      
- [ ] Dado que clico em notificação
      Quando redirecionado
      Então acesso thread + comentário com menção é destacado
      
- [ ] Dado que João menciona "@Maria @Pedro"
      Quando comentário é publicado
      Então Maria E Pedro recebem notificações separadas
      
- [ ] Dado que desabilito notificações de menção
      Quando sou mencionado
      Então nenhuma notificação é enviada

##### Prioridade
**Alta** - Engajamento direto

##### Complexidade
**Média** - Parse de mentions + notificações batch

##### Dependências
RF027 (Comentar)

##### Notas/Observações
- Detecção: regex @(\w+) para extrair usernames
- Validação: verificar se username existe antes de notificar
- Email: template com contexto completo (thread + comentário)
- Link: ir direto para comentário mencionado
- Highlight: comentário com mention destacado em cor diferente
- Limitar: máximo 10 mentions por comentário (spam prevention)
- Considerar "@ everyone" para moderadores (Fase 2)



#### RF179 - Central de notificações

##### User Story
Como **usuário**
Quero **visualizar todas as minhas notificações em um único lugar**
Para **acompanhar tudo o que recebi sem perder informações**

##### Descrição
Hub centralizado mostrando todas notificações com filtros por tipo, período e status. Ordenação por recência, ações em massa (marcar como lida), e sincronização em tempo real com badge de contagem.

##### Regras de Negócio
- RN001: Exibir todas notificações do usuário logado (histático)
- RN002: Ordenação padrão: mais recentes primeiro
- RN003: Filtros: por tipo (comentários, amizade, eventos, badges, menções)
- RN004: Filtro: lidas/não-lidas
- RN005: Paginação: 20 notificações por página
- RN006: Badge de contagem: mostrar # de não-lidas no ícone
- RN007: Sincronização real-time: novo notificações aparecem sem refresh
- RN008: Search: permitir busca por palavra-chave

##### Critérios de Aceitação
- [ ] Dado que acesso "Centro de Notificações"
      Quando carrega
      Então vejo lista com TODAS notificações ordenadas por data (recentes primeiro)
      
- [ ] Dado que tenho 25 notificações não-lidas
      Quando visualizo icon de notificação
      Então vejo badge com "25" em vermelho
      
- [ ] Dado que filtro por "Comentários"
      Quando aplico
      Então vejo apenas notificações de tipo comentário
      
- [ ] Dado que filtro por "Não lidas"
      Quando aplico
      Então vejo apenas notificações não marcadas como lidas
      
- [ ] Dado que nova notificação chega
      Quando sistema sincroniza
      Então notificação aparece no topo em tempo real (sem refresh)
      
- [ ] Dado que clico em notificação
      Quando ação executa
      Então redirecionado para contexto relevante

##### Prioridade
**Alta** - Hub essencial

##### Complexidade
**Média** - Query com filtros + real-time sync

##### Dependências
RF169-RF178 (Todas notificações)

##### Notas/Observações
- Tabela `notifications`: id, user_id, notification_type, related_id, content, is_read, created_at
- Query: SELECT * FROM notifications WHERE user_id=? ORDER BY created_at DESC LIMIT 20 OFFSET ?
- Filtros: WHERE notification_type IN (?) OR is_read=?
- Real-time: WebSocket para novos eventos (SSE como fallback)
- Badge: SELECT COUNT(*) FROM notifications WHERE user_id=? AND is_read=0
- Busca full-text: MATCH(content) AGAINST(?)
- Paginação: cursor-based com created_at
- Considerar "Starred" notificações (Fase 2)



#### RF180 - Marcar notificação como lida

##### User Story
Como **usuário**
Quero **marcar notificações como lidas quando leio**
Para **diferenciar o que já vi do que ainda preciso acompanhar**

##### Descrição
Ação que marca notificação individual como lida, removendo do contador de não-lidas e atualizando visual (remove highlight/ícone de não-lida).

##### Regras de Negócio
- RN001: Clicar em notificação marca automaticamente como lida
- RN002: Botão manual "Marcar como lida" disponível na Central
- RN003: Update: is_read=1, read_at=NOW()
- RN004: Badge de contagem atualiza em tempo real
- RN005: Notificação já lida não pode ser marcada como não-lida novamente
- RN006: Reversível: pode "Marcar como não-lida" (Fase 2)

##### Critérios de Aceitação
- [ ] Dado que visualizo notificação não-lida (com highlight)
      Quando clico em notificação
      Então é marcada como lida automaticamente
      
- [ ] Dado que notificação é marcada como lida
      Quando verifico Centro de Notificações
      Então highlight desaparece e não conta no badge
      
- [ ] Dado que visualizo notificação lida
      Quando clico em "Marcar como lida" (botão)
      Então ação não faz nada (já está lida)
      
- [ ] Dado que tinha 5 não-lidas
      Quando marco 1 como lida
      Então badge atualiza para "4" em tempo real
      
- [ ] Dado que clico em notificação
      Quando ação processa
      Então é_read=1 e read_at é registrado no BD

##### Prioridade
**Alta** - Interação essencial

##### Complexidade
**Baixa** - Update simples

##### Dependências
RF179 (Central de notificações)

##### Notas/Observações
- Query: UPDATE notifications SET is_read=1, read_at=NOW() WHERE id=? AND user_id=?
- Auto-mark: ao redirecionar para contexto, marcar notificação como lida
- Visual: CSS class "not-read" removed quando lida
- Badge: atualizar em tempo real (WebSocket ou AJAX)
- Timestamp: read_at importante para analytics (tempo até leitura)



#### RF181 - Marcar todas como lidas

##### User Story
Como **usuário com muitas notificações não-lidas**
Quero **marcar todas as notificações como lidas de uma vez**
Para **limpar o inbox rápido e começar do zero**

##### Descrição
Ação em massa que marca todas notificações do usuário como lidas em um clique. Inclui confirmação opcional e atualização instantânea do badge e visual.

##### Regras de Negócio
- RN001: Ação "Marcar Todas como Lidas" visível apenas se há não-lidas
- RN002: Requer confirmação (opcional: "Tem certeza?")
- RN003: Update batch: UPDATE notifications SET is_read=1 WHERE user_id=?
- RN004: Badge atualiza para 0 imediatamente
- RN005: Todas notificações na Central perdem highlight
- RN006: Operação reversível em Fase 2

##### Critérios de Aceitação
- [ ] Dado que tenho 42 notificações não-lidas
      Quando visualizo Centro de Notificações
      Então vejo botão "Marcar Todas como Lidas"
      
- [ ] Dado que clico em "Marcar Todas como Lidas"
      Quando confirmo
      Então todas notificações são marcadas como lidas instantaneamente
      
- [ ] Dado que ação processa
      Quando visualizo
      Então badge muda para "0" e todos highlights desaparecem
      
- [ ] Dado que já marquei todas como lidas
      Quando recebo nova notificação
      Então botão reaparece (se nova não-lida existe)
      
- [ ] Dado que clico em "Marcar Todas"
      Quando confirmo
      Então BD processa: UPDATE ... is_read=1 WHERE user_id=?

##### Prioridade
**Média** - Conveniência

##### Complexidade
**Baixa** - Batch update

##### Dependências
RF179 (Central de notificações), RF180 (Marcar individual)

##### Notas/Observações
- Query: UPDATE notifications SET is_read=1, read_at=NOW() WHERE user_id=? AND is_read=0
- Confirmação: modal simples com "Tem certeza? Todas serão marcadas"
- Performance: usar batch update (não loop individual)
- Botão: desabilitado se 0 não-lidas
- Visual: transição suave quando highlights removidos
- Logging: registrar ação para analytics



#### RF182 - Configurações de notificações (ativar/desativar por tipo)

##### User Story
Como **usuário**
Quero **configurar quais tipos de notificações recebo**
Para **personalizar minha experiência e não ser incomodado com alertas irrelevantes**

##### Descrição
Painel de preferências permitindo ativar/desativar cada tipo de notificação (comentários, amizade, eventos, badges, mencções, etc). Inclui opções de canal (in-app, email, SMS) e frequência de entrega.

##### Regras de Negócio
- RN001: Todas notificações ativadas por padrão (opt-out)
- RN002: Tipos configuráveis: comentários, amizade, eventos, badges, menções, mentorias
- RN003: Canais: in-app (sempre), email (opt-in), SMS (opt-in futura)
- RN004: Frequência: instantânea, resumida (diária), desabilitada
- RN005: Armazenar preferências em tabela `user_notification_preferences`
- RN006: Alterações são imediatas (sem confirmação)
- RN007: Toggle switches com labels claros

##### Critérios de Aceitação
- [ ] Dado que acesso "Configurações de Notificações"
      Quando carrega
      Então vejo lista com todos tipos de notificações
      
- [ ] Dado que tipos são listados
      Quando visualizo
      Então vejo: comentários, amizade, eventos, badges, menções, mentorias (com toggle)
      
- [ ] Dado que desabilito "Notificações de Comentários"
      Quando salvo
      Então nenhuma notificação de comentário é enviada daqui em diante
      
- [ ] Dado que habilito "Email para Eventos"
      Quando salvo
      Então notificações de evento são enviadas também por email
      
- [ ] Dado que defino frequência "Resumida" para Badges
      Quando sistema processa
      Então badges conquistadas são agrupadas e enviadas diariamente
      
- [ ] Dado que retorno às configurações
      Quando visualizo
      Então preferências salvas estão selecionadas (estado persistido)

##### Prioridade
**Alta** - Controle do usuário

##### Complexidade
**Média** - CRUD de preferências com múltiplas opções

##### Dependências
RF169-RF178 (Todas notificações)

##### Notas/Observações
- Tabela `user_notification_preferences`: user_id, notification_type, enabled, channel (in_app/email/sms), frequency, updated_at
- Tipos: comment_new, friend_request_received, friend_request_accepted, new_mentee, mentor_assigned, event_reminder, event_cancelled, badge_achieved, upvote_received, mention_in_comment
- Canais padrão: in_app=sempre, email=opt-in, sms=future
- Frequência: instant, daily_digest, disabled
- Validação: verificar preferência antes de enviar qualquer notificação
- UI: toggle switches com descriptions claras (ex: "Ser notificado quando alguém comentar em minha thread")
- Considerar "Quiet hours" (Fase 2) para não receber notificações entre X e Y horas



#### RF183 - Denunciar thread inadequada

##### User Story
Como **usuário**
Quero **denunciar threads que violam diretrizes ou são inadequadas**
Para **ajudar moderadores a manter qualidade do fórum**

##### Descrição
Funcionalidade permitindo usuários denunciar thread problemática. Abre modal com seleção de motivo, descrição opcional e confirmação. Denúncia é armazenada para moderadores processarem.

##### Regras de Negócio
- RN001: Apenas usuários autenticados podem denunciar
- RN002: Denúncia inclui: thread_id, user_id (denunciante), motivo, descrição, timestamp
- RN003: Não permitir denúncia de thread própria (validação)
- RN004: Denúncia é anônima para autor da thread
- RN005: Armazenar em tabela `reports` com status "pending"
- RN006: Confirmação visual: "Denúncia enviada com sucesso"
- RN007: Notificação ao moderador após envio

##### Critérios de Aceitação
- [ ] Dado que visualizo thread
      Quando clico em menu "..."
      Então vejo opção "Denunciar"
      
- [ ] Dado que clico em "Denunciar"
      Quando modal abre
      Então vejo: título da thread, seletor de motivo, campo de descrição opcional
      
- [ ] Dado que sou autor da thread
      Quando acesso ações
      Então opção "Denunciar" não aparece (desabilitada)
      
- [ ] Dado que seleciono motivo "Spam"
      Quando confirmo
      Então denúncia é enviada + modal fecha com mensagem "Obrigado!"
      
- [ ] Dado que denúncia é enviada
      Quando verifico banco de dados
      Então registro em `reports` com: thread_id, user_id, motivo, created_at, status='pending'
      
- [ ] Dado que clico em "Denunciar"
      Quando ação completa
      Então moderador recebe notificação (ou alerta em painel)

##### Prioridade
**Alta** - Controle de qualidade comunitário

##### Complexidade
**Média** - Modal com validação + notificação

##### Dependências
RF022 (Criar thread), RF129 (Fila de denúncias)

##### Notas/Observações
- Tabela `reports`: id, reported_type (thread/comment/user), reported_id, reporter_id, reason, description, status, created_at, handled_by, handled_at
- Validação: WHERE reporter_id != thread_creator_id
- Modal: form com dropdown motivo + textarea para descrição (max 500 caracteres)
- Confirmação: toast/snackbar "Denúncia enviada. Obrigado por ajudar!"
- Notificação moderador: usar RF169+ para alertar painel
- Auditoria: registrar IP/user-agent para detecção de abuso
- Considerar "Denúncias em massa" detection (Fase 2)



#### RF184 - Denunciar comentário inadequado

##### User Story
Como **usuário**
Quero **denunciar comentários que violam diretrizes**
Para **sinalizar conteúdo problemático rapidamente**

##### Descrição
Funcionalidade permitindo denunciar comentário específico dentro de thread. Inclui seleção de motivo e descrição opcional. Denúncia é processada por moderadores com prioridade.

##### Regras de Negócio
- RN001: Apenas usuários autenticados podem denunciar
- RN002: Denúncia não permite ser do próprio autor (validação)
- RN003: Armazenar: comment_id, reporter_id, motivo, descrição, thread_id (contexto)
- RN004: Status inicial: "pending"
- RN005: Anônimo para autor do comentário
- RN006: Confirmação imediata
- RN007: Contabilizar denúncias do mesmo comentário (contador)

##### Critérios de Aceitação
- [ ] Dado que visualizo comentário em thread
      Quando clico em menu "..."
      Então vejo opção "Denunciar Comentário"
      
- [ ] Dado que clico em "Denunciar"
      Quando modal abre
      Então vejo: preview do comentário, seletor motivo, campo descrição
      
- [ ] Dado que sou autor do comentário
      Quando acesso menu
      Então opção "Denunciar" não aparece
      
- [ ] Dado que seleciono motivo e confirmo
      Quando denúncia processa
      Então recebo confirmação "Denúncia enviada"
      
- [ ] Dado que mesmo comentário recebe múltiplas denúncias
      Quando sistema processa
      Então contador aumenta (visível apenas para moderador)
      
- [ ] Dado que denúncia é criada
      Quando verifico BD
      Então registro contém: comment_id, thread_id, reporter_id, motivo

##### Prioridade
**Alta** - Controle de qualidade

##### Complexidade
**Média** - Modal com preview + validação

##### Dependências
RF027 (Comentar), RF129 (Fila de denúncias)

##### Notas/Observações
- Preview comentário: mostrar primeiros 200 caracteres em readonly
- Validação: WHERE reporter_id != comment_author_id
- Modal: similar a RF183 mas com contexto de thread
- Contador denúncias: SELECT COUNT(*) FROM reports WHERE comment_id=?
- Link ao moderador: mostrar thread + comentário destacado
- Considerar "Denúncia rápida" sem descrição obrigatória (Fase 2)



#### RF185 - Denunciar perfil/usuário

##### User Story
Como **usuário**
Quero **denunciar perfil ou comportamento inadequado de outro usuário**
Para **alertar moderadores sobre usuários problemáticos ou predadores**

##### Descrição
Funcionalidade permitindo denunciar usuário por comportamento inadequado (assédio, spam, conteúdo ofensivo, etc). Denúncia é dirigida ao admin com contexto sobre o problema. Suporta evidências (links para threads/comentários).

##### Regras de Negócio
- RN001: Apenas usuários autenticados podem denunciar
- RN002: Não permitir auto-denúncia (validação)
- RN003: Motivos específicos para usuários: assédio, spam, conteúdo ofensivo, preconceito, outro
- RN004: Incluir campo para "evidências" (links a threads/comentários específicas)
- RN005: Descrição obrigatória para denúncia de usuário
- RN006: Status: "pending_review" (prioridade alta)
- RN007: Armazenar: reported_user_id, reporter_id, motivo, descrição, evidence_links

##### Critérios de Aceitação
- [ ] Dado que visualizo perfil de usuário
      Quando clico em menu "..."
      Então vejo opção "Denunciar Usuário"
      
- [ ] Dado que clico em "Denunciar"
      Quando modal abre
      Então vejo: nome do usuário, motivos específicos (dropdown), campo descrição obrigatório
      
- [ ] Dado que seleciono "Assédio"
      Quando descroço
      Então vejo campo "Adicionar evidências" (links para comentários/threads)
      
- [ ] Dado que adiciono link de evidência
      Quando valido
      Então sistema valida se link é válido (existe no BD)
      
- [ ] Dado que confirmo denúncia
      Quando processa
      Então denúncia é armazenada com status "pending_review"
      
- [ ] Dado que sou o usuário sendo denunciado
      Quando acesso meu perfil
      Então não vejo nada (denúncia é anônima e confidencial)

##### Prioridade
**Alta** - Segurança da comunidade

##### Complexidade
**Alta** - Validação de evidências + sensibilidade

##### Dependências
RF001 (Cadastro de usuários), RF129 (Fila denúncias)

##### Notas/Observações
- Tabela `reports`: type='user', reported_user_id, evidence_links (JSON array)
- Evidence validation: verificar se comentário_id/thread_id existe e é do usuário denunciado
- Motivos usuário: "harassment", "spam", "offensive_content", "hate_speech", "other"
- Descrição: mínimo 20 caracteres (evitar denúncias vazias)
- Evidence links: permite múltiplos links (array)
- Processamento: enviar para admin com HIGH priority
- Considerar "Denúncia de assédio sexual" com tratamento especial (LGPD)



#### RF186 - Selecionar motivo da denúncia (lista predefinida)

##### User Story
Como **usuário que denuncia conteúdo**
Quero **escolher o motivo específico da denúncia de uma lista predefinida**
Para **categorizar claramente o problema e ajudar moderadores**

##### Descrição
Dropdown/lista com motivos pré-categorizados para denúncias. Motivos variam por tipo (thread/comentário/usuário). Seleção é obrigatória. Permite "Outro" com descrição adicional.

##### Regras de Negócio
- RN001: Motivos para thread/comentário: Spam, Conteúdo inadequado, Violação diretrizes, Preconceito/Ódio, Enganoso, Outro
- RN002: Motivos para usuário: Assédio, Spam, Conteúdo ofensivo, Preconceito/Ódio, Suspeita predador, Outro
- RN003: Seleção obrigatória (campo required)
- RN004: Se "Outro" selecionado: campo de texto livre adicional (máx 200 chars)
- RN005: Motivos pré-traduzidos se multi-idioma (Fase 2)
- RN006: Não permitir envio sem motivo selecionado

##### Critérios de Aceitação
- [ ] Dado que abro modal de denúncia
      Quando visualizo
      Então vejo dropdown com motivos pré-definidos
      
- [ ] Dado que motivos exibidos (para thread)
      Quando visualizo
      Então vejo: "Spam", "Conteúdo inadequado", "Violação diretrizes", "Preconceito/Ódio", "Enganoso", "Outro"
      
- [ ] Dado que seleciono "Spam"
      Quando confirmo
      Então motivo é registrado com reason_code='spam'
      
- [ ] Dado que seleciono "Outro"
      Quando confirmação
      Então campo de texto adicional aparece (descrição do motivo)
      
- [ ] Dado que deixo motivo em branco
      Quando tento enviar
      Então botão está desabilitado ou erro aparece "Selecione um motivo"
      
- [ ] Dado que confirmo denúncia
      Quando BD registra
      Então reason_code é armazenado para analytics

##### Prioridade
**Alta** - Categorização essencial

##### Complexidade
**Baixa** - Validação de dropdown

##### Dependências
RF183-RF185 (Denúncias)

##### Notas/Observações
- Lista motivos por tipo (thread/comment/user) em enum
- Dropdown com ícones (opcional) para cada motivo
- Help text: tooltip explicando cada motivo
- "Outro" com textarea: min 10 chars, max 200 chars
- Analytics: contar denúncias por motivo para identificar problemas comuns
- Considerar "Motivos customizáveis" por admin (Fase 2)



#### RF187 - Adicionar descrição opcional à denúncia

##### User Story
Como **usuário que denuncia**
Quero **adicionar uma descrição detalhada à denúncia (opcional)**
Para **fornecer contexto adicional que ajude moderadores a entender o problema**

##### Descrição
Campo de texto livre permitindo usuário adicionar contexto/detalhes além do motivo pré-definido. Campo é opcional mas recomendado para denúncias complexas. Suporta formatação básica (quebras de linha).

##### Regras de Negócio
- RN001: Campo totalmente opcional (pode enviar só com motivo)
- RN002: Máximo 1000 caracteres
- RN003: Suporta quebras de linha (enter)
- RN004: Sem HTML/markdown (apenas texto puro)
- RN005: Caracteres especiais permitidos
- RN006: Campo placeholder: "Descreva o problema em detalhes (opcional)"
- RN007: Contador de caracteres visível (ex: "250/1000")

##### Critérios de Aceitação
- [ ] Dado que abro modal de denúncia
      Quando visualizo
      Então vejo campo textarea "Descrição (opcional)"
      
- [ ] Dado que digito descrição detalhada
      Quando texto aparece
      Então contador mostra "150/1000" (em tempo real)
      
- [ ] Dado que tento digitar 1100 caracteres
      Quando atingo 1000
      Então campo não permite mais input (soft limit)
      
- [ ] Dado que pressionei Enter
      Quando linha quebra
      Então quebra de linha é preservada (no BD e exibição)
      
- [ ] Dado que deixo descrição vazia
      Quando confirmo denúncia
      Então denúncia é enviada normalmente (campo opcional)
      
- [ ] Dado que descrição é enviada
      Quando moderador visualiza
      Então texto aparece formatado com quebras de linha

##### Prioridade
**Média** - Contexto útil

##### Complexidade
**Baixa** - Textarea com validação

##### Dependências
RF183-RF185 (Denúncias)

##### Notas/Observações
- Campo textarea com placeholder claro
- Contador de caracteres abaixo: "XXX/1000"
- Validação: strip HTML tags (sanitize input)
- Armazenamento: description varchar(1000) NULL
- Display: manter quebras de linha como \n
- Autocomplete desabilitado (sensitive field)
- Considerar "Anexar screenshot" (Fase 2)



#### RF188 - Confirmação de envio de denúncia

##### User Story
Como **usuário que enviou denúncia**
Quero **receber confirmação visual de que minha denúncia foi enviada com sucesso**
Para **ter certeza que meu relato chegou aos moderadores**

##### Descrição
Modal ou toast de confirmação exibindo após envio de denúncia com mensagem clara, possibilidade de enviar nova denúncia ou voltar ao conteúdo. Inclui número de denúncia para referência (opcional).

##### Regras de Negócio
- RN001: Confirmação exibida imediatamente após sucesso
- RN002: Mensagem: "Obrigado! Sua denúncia foi recebida e será analisada"
- RN003: Opções: "Voltar ao conteúdo" ou "Fazer outra denúncia"
- RN004: Gerar e exibir ID de denúncia (para referência)
- RN005: Duração da confirmação: 5 segundos (ou clique para fechar)
- RN006: Email de confirmação (opcional, se user habilitou)

##### Critérios de Aceitação
- [ ] Dado que confirmo envio de denúncia
      Quando requisição processa com sucesso
      Então modal/toast aparece: "Obrigado! Sua denúncia foi recebida"
      
- [ ] Dado que confirmação é exibida
      Quando visualizo
      Então vejo número de denúncia (ex: "Report #12345")
      
- [ ] Dado que clico em "Voltar ao Conteúdo"
      Quando ação executa
      Então redirecionado para thread/comentário/perfil original
      
- [ ] Dado que clico em "Fazer Outra Denúncia"
      Quando ação executa
      Então volto para listagem (poder denunciar outra thread)
      
- [ ] Dado que confirmação fica 5 segundos visível
      Quando tempo expira
      Então modal fecha automaticamente
      
- [ ] Dado que denúncia é recebida
      Quando user habilitou email
      Então recebe email: "Recebemos sua denúncia #12345"

##### Prioridade
**Média** - Experiência do usuário

##### Complexidade
**Baixa** - Modal/toast de confirmação

##### Dependências
RF183-RF185 (Denúncias)

##### Notas/Observações
- Toast type: "success" com ícone ✓
- Modal com botões: "Voltar ao conteúdo" (primary), "Fazer outra denúncia" (secondary)
- Report ID: auto-incremento ou UUID
- Email template: incluir número denúncia + link para acompanhar (se fase 2)
- Close button (X): permite fechar imediatamente
- Delay antes de fechar: 5s ou clique
- Considerar "Botão compartilhar ID" (Fase 2) para referência com moderador



#### RF189 - Prevenir múltiplas denúncias do mesmo conteúdo pelo mesmo usuário

##### User Story
Como **sistema**
Quero **prevenir que um usuário denuncie o mesmo conteúdo múltiplas vezes**
Para **evitar spam de denúncias e manter banco de dados limpo**

##### Descrição
Validação que impede user de enviar mais de uma denúncia para o mesmo conteúdo. Se user já denunciou, alerta é exibido ("Você já denunciou este conteúdo") e ação é bloqueada.

##### Regras de Negócio
- RN001: Validar: SELECT * FROM reports WHERE reporter_id=? AND reported_id=? AND reported_type=?
- RN002: Se denúncia existente com status "pending" ou "approved": bloquear
- RN003: Se denúncia foi "rejected": permitir nova (após revisão)
- RN004: Se denúncia foi "resolved": permitir nova (conteúdo voltou ao problema?)
- RN005: Mensagem de alerta: "Você já denunciou este conteúdo. Status: [pending/approved/rejected]"
- RN006: Botão "Denunciar" fica desabilitado com tooltip explicativo

##### Critérios de Aceitação
- [ ] Dado que denunciei thread X
      Quando acesso thread X novamente
      Então botão "Denunciar" fica desabilitado com tooltip
      
- [ ] Dado que clico no botão desabilitado
      Quando visualizo tooltip
      Então vejo: "Você já denunciou este conteúdo"
      
- [ ] Dado que denúncia anterior foi rejeitada
      Quando visualizo thread
      Então botão "Denunciar" fica habilitado (posso denunciar novamente)
      
- [ ] Dado que denúncia anterior tem status "pending"
      Quando verifico BD
      Então query bloquearia nova denúncia: COUNT > 0
      
- [ ] Dado que try enviar denúncia duplicada via API
      Quando validação processa
      Então erro 409: "Você já denunciou este conteúdo"
      
- [ ] Dado que deixa thread por dias
      Quando volta após conteúdo ser "re-violado"
      Então pode denunciar novamente (se status permitir)

##### Prioridade
**Média** - Integridade de denúncias

##### Complexidade
**Média** - Validação com múltiplos estados

##### Dependências
RF183-RF185 (Denúncias), RF129 (Fila denúncias)

##### Notas/Observações
- Tabela `reports`: reported_type, reported_id, reporter_id, status (pending/approved/rejected/resolved)
- Query validação: WHERE reporter_id=? AND reported_id=? AND reported_type=? AND status IN ('pending', 'approved')
- Frontend: desabilitar botão se existe denúncia com status bloqueador
- Backend: validar mesmo assim (segurança)
- Tooltip: mostrar status da denúncia anterior (pending=em análise, etc)
- Email notificação: "Você já denunciou este conteúdo em [data]. Status: [status]"
- Estados que bloqueiam: pending, approved
- Estados que permitem nova: rejected (revogada), resolved (resolvida)
- Considerar "Atualizar denúncia" ao invés de bloquear (Fase 2)